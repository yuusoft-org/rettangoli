---
title: Support multiple screenshots in one session
status: todo
priority: low
---

# Description

## Context

- Currently `rtgl vt generate`, for each page, it generates only one screeshot per page. This does not work when a page needs some interactions such as click a button, and take another screenshot of that.


## Solution

in the test front matter we currently have something like this:
```yaml
---
title: "Background color with hover"
---
```

update it with something like this:


```yaml
---
title: "Background color with hover"
instructions:
  - mv 20 50    # move to position x: 20, y: 50
  - click       # click mouse
  - screenshot  # take a screenshot
  - key k       # press keyboard k
  - wait 4000   # wait 4 seconds
  - rclick      # right click
  - screenshot  # take screenshot
---
```

for naming for format of these, try comeup with something simple and easy to write and read.

we're using Playwright, so should be easy to implmeent those actions https://playwright.dev/docs/api/class-page#page-click

only implment the actions that we actually need. dont implement any actions that have DOM dependency such as `page.getByLabel('Choose a color')`



2 ways to implement the screenshots:

option 1
- multiple screenshots will just be vertically concatanated into 1 screenshot image. so it will be a very long 

option 2
- when taking multiple screenshots, create a new image, by appending a suffix to the filename. for example:
  - background-color-with-hover.webp
  - background-color-with-hover-1.webp
  - background-color-with-hover-2.webp
  - background-color-with-hover-3.webp
this may be more scalable as easier for image diff algorithmes.

 we had some old code implementation in `packages/rettangoli-vt/src/common.js`, which got the data from html comments instead of yaml, and used option 1 to concatenate image. instead lets move to yaml and option 2 with separate images


reference to old code:

```js
          // example instructions:
          for (const instruction of file.frontMatter?.instructions || []) {
            const [command, ...args] = instruction.split(" ");
            switch (command) {
              case "lc":
                const x = Number(args[0]);
                const y = Number(args[1]);
                await page.mouse.click(x, y, {
                  button: "left",
                });
                break;
              case "ss":
                const baseName = file.path.replace(/\.[^/.]+$/, "");
                const tempAdditionalPngPath = join(
                  screenshotsDir,
                  `${baseName}-${args[0]}.png`
                );
                const additonalScreenshotPath = join(
                  screenshotsDir,
                  `${baseName}-${args[0]}.webp`
                );
                console.log(`Taking additional screenshot at ${additonalScreenshotPath}`);

                // Take screenshot as PNG first
                await page.screenshot({
                  path: tempAdditionalPngPath,
                  fullPage: true
                });

                // Convert PNG to WebP using Sharp
                await sharp(tempAdditionalPngPath)
                  .webp({ quality: 85 })
                  .toFile(additonalScreenshotPath);

                // Remove temporary PNG file
                if (existsSync(tempAdditionalPngPath)) {
                  unlinkSync(tempAdditionalPngPath);
                }

                console.log(
                  `Additional screenshot taken at ${additonalScreenshotPath}`
                );
                break;
            }
          }

```
