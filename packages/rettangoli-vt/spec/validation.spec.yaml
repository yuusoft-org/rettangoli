file: "../src/validation.js"
group: vt-validation
---
suite: validateVtConfig
exportName: validateVtConfig
---
case: accepts minimal valid vt config
in:
  - path: ./vt
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
out:
  path: ./vt
  sections:
    - title: Pages
      files: pages
---
case: accepts page keys with hyphen and underscore
in:
  - path: ./vt
    sections:
      - title: components_basic
        files: components
      - type: groupLabel
        title: Group label can have spaces
        items:
          - title: forms-advanced
            files: forms
  - rettangoli.config.yaml
out:
  path: ./vt
  sections:
    - title: components_basic
      files: components
    - type: groupLabel
      title: Group label can have spaces
      items:
        - title: forms-advanced
          files: forms
---
case: requires sections to be a non-empty array
in:
  - path: ./vt
  - rettangoli.config.yaml
throws: vt.sections
---
case: rejects spaces in flat section title
in:
  - path: ./vt
    sections:
      - title: components basic
        files: components
  - rettangoli.config.yaml
throws: cannot include spaces
---
case: rejects spaces in group item title
in:
  - path: ./vt
    sections:
      - type: groupLabel
        title: Group label
        items:
          - title: forms advanced
            files: forms
  - rettangoli.config.yaml
throws: cannot include spaces
---
case: rejects case-insensitive duplicate section page keys
in:
  - path: ./vt
    sections:
      - title: button-basic
        files: components
      - type: groupLabel
        title: Group label
        items:
          - title: Button-Basic
            files: components/forms
  - rettangoli.config.yaml
throws: must be unique (case-insensitive)
---
case: rejects legacy root capture options
in:
  - path: ./vt
    waitSelector: "#root"
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
throws: vt.waitSelector
---
case: accepts minimal runtime knobs
in:
  - path: ./vt
    concurrency: 4
    timeout: 45000
    waitEvent: app:ready
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
out:
  path: ./vt
  concurrency: 4
  timeout: 45000
  waitEvent: app:ready
  sections:
    - title: Pages
      files: pages
---
case: accepts minimal managed service config
in:
  - path: ./vt
    url: http://127.0.0.1:4173
    service:
      start: bun run preview
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
out:
  path: ./vt
  url: http://127.0.0.1:4173
  service:
    start: bun run preview
  sections:
    - title: Pages
      files: pages
---
case: rejects managed service without vt.url
in:
  - path: ./vt
    service:
      start: bun run preview
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
throws: vt.url
---
case: rejects unsupported service keys
in:
  - path: ./vt
    url: http://127.0.0.1:4173
    service:
      start: bun run preview
      cwd: .
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
throws: supports only "start"
---
case: accepts single viewport object
in:
  - path: ./vt
    viewport:
      id: desktop
      width: 1280
      height: 720
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
out:
  path: ./vt
  viewport:
    id: desktop
    width: 1280
    height: 720
  sections:
    - title: Pages
      files: pages
---
case: accepts viewport array with unique ids
in:
  - path: ./vt
    viewport:
      - id: desktop
        width: 1280
        height: 720
      - id: mobile
        width: 390
        height: 844
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
out:
  path: ./vt
  viewport:
    - id: desktop
      width: 1280
      height: 720
    - id: mobile
      width: 390
      height: 844
  sections:
    - title: Pages
      files: pages
---
case: rejects viewport entries without id
in:
  - path: ./vt
    viewport:
      width: 1280
      height: 720
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
throws: vt.viewport[0].id
---
case: rejects duplicate viewport ids case-insensitively
in:
  - path: ./vt
    viewport:
      - id: Desktop
        width: 1280
        height: 720
      - id: desktop
        width: 390
        height: 844
    sections:
      - title: Pages
        files: pages
  - rettangoli.config.yaml
throws: duplicates
---
case: rejects vt.capture user config
in:
  - path: ./vt
    sections:
      - title: Pages
        files: pages
    capture:
      waitStrategy: load
  - rettangoli.config.yaml
throws: vt.capture
---
suite: validateFrontMatter
exportName: validateFrontMatter
---
case: accepts block steps and wait selector strategy
in:
  - waitStrategy: selector
    waitSelector: "#ready"
    steps:
      - select search-input:
          - write hi
          - keypress Enter
  - specs/page.yaml
---
case: accepts frontmatter viewport override object
in:
  - viewport:
      id: tablet
      width: 768
      height: 1024
  - specs/page.yaml
---
case: accepts frontmatter viewport override array
in:
  - viewport:
      - id: desktop
        width: 1280
        height: 720
      - id: mobile
        width: 390
        height: 844
  - specs/page.yaml
---
case: rejects frontmatter viewport without id
in:
  - viewport:
      width: 768
      height: 1024
  - specs/page.yaml
throws: frontMatter.viewport[0].id
---
case: rejects empty step strings
in:
  - steps:
      - ""
  - specs/page.yaml
throws: frontMatter.steps[0]
