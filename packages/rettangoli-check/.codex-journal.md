# Codex Checker Journal

This file is append-only.
Each iteration should add:
- iteration number and timestamp
- what changed
- blockers
- next step hypothesis

## Iteration 1 - 2026-02-13T10:50:45Z
- completed changes:
  - added scenario `11-yahtml-global-attrs` to cover standard global attributes on custom elements (`tabindex`, `hidden`, `part`, `exportparts`, `lang`, `dir`, `draggable`, `spellcheck`, `translate`, `inert`, `contenteditable`).
  - expanded YAHTML generic allowlist in `src/rules/yahtmlAttrs.js` to include standard global HTML attributes for custom elements (`accesskey`, `autocapitalize`, `autofocus`, `contenteditable`, `dir`, `draggable`, `enterkeyhint`, `exportparts`, `hidden`, `inert`, `inputmode`, `lang`, `nonce`, `part`, `spellcheck`, `tabindex`, `translate`).
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add YAHTML scenarios for event/listener binding tokens (for example `@click=` and dynamic spread-like attr fragments) to reduce parser-driven false positives without broadening attr allowlists.

## Iteration 1 - 2026-02-13T10:51:19Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 11
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new scenario test for YAHTML global attributes on custom elements:
  - `packages/rettangoli-check/test/scenarios/11-yahtml-global-attrs/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/11-yahtml-global-attrs/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/11-yahtml-global-attrs/expected.json:1`
- Expanded YAHTML generic allowed attrs in `packages/rettangoli-check/src/rules/yahtmlAttrs.js:3` to include standard global attrs (`tabindex`, `hidden`, `part`, `exportparts`, `lang`, `dir`, `draggable`, `spellcheck`, `translate`, `inert`, `contenteditable`, plus related globals).
- Appended iteration journal entry to `packages/rettangoli-check/.codex-journal.md:10`.

**Why This Improves Reliability/Simplicity**
- Reliability: avoids false positives for valid global HTML attributes commonly used on custom elements.
- Simplicity: kept logic change minimal (single allowlist expansion) and locked behavior with a scenario test first.

**Scenario Test Result**
- Ran full suite with `node packages/rettangoli-check/test/run-scenarios.mjs`.
- Result: `All scenarios passed: 11/11`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements

All scenarios passed: 11/11

## Iteration 2 - 2026-02-13T10:53:57Z
- completed changes:
  - added scenario `12-commented-exports-ignored` covering cross-file handler/action/method symbol references when matching names appear only inside JS comments or string literals.
  - hardened `extractNamedExports` in `src/core/parsers.js` by masking comments and quoted strings before export regex scanning, preventing false symbol matches from non-code text.
  - ran targeted scenario and full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused scenario for re-export patterns (`export { fn } from` and alias forms) to improve cross-file symbol resolution coverage without broad parser complexity.

## Iteration 2 - 2026-02-13T10:54:28Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 12
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added scenario `12-commented-exports-ignored` to lock cross-file symbol behavior when handler/action/method names appear only in comments/strings:
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/src/components/card/card.handlers.js:1`
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/src/components/card/card.store.js:1`
  - `packages/rettangoli-check/test/scenarios/12-commented-exports-ignored/src/components/card/card.methods.js:1`
- Hardened export extraction in `packages/rettangoli-check/src/core/parsers.js:29` and `packages/rettangoli-check/src/core/parsers.js:103`:
  - Added masking for comments and quoted strings before export-regex scanning.
  - `extractNamedExports` now scans sanitized source to avoid false symbol matches from non-code text.
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:59`

**Why This Improves Reliability/Simplicity**
- Reliability: cross-file symbol checks for handlers/actions/methods no longer treat commented/string “export …” text as real exports, preventing false passes.
- Simplicity: change is localized to one parser helper path; existing cross-file rules remain unchanged and deterministic.

**Scenario Test Result**
- Ran `node packages/rettangoli-check/test/run-scenarios.mjs --scenario 12-commented-exports-ignored`: pass.
- Ran full suite `node packages/rettangoli-check/test/run-scenarios.mjs`: `All scenarios passed: 12/12`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols

All scenarios passed: 12/12

## Iteration 3 - 2026-02-13T10:58:21Z
- completed changes:
  - added scenario `13-quoted-selector-escaped-quotes` to cover YAML template list keys where the selector line is double-quoted and contains escaped quotes in an attribute value.
  - fixed `splitYamlListLineKey` in `src/core/parsers.js` to correctly handle escaped quote sequences while scanning for the selector/value separator (`:`).
  - updated `stripOuterQuotes` in `src/core/parsers.js` to unescape quoted YAML key content (`\"`, `\\`, and doubled single quotes), so selector/binding tokenization sees the intended text.
  - hardened `ATTR_REGEX` in `src/core/parsers.js` to handle escaped characters inside quoted binding values.
  - ran targeted and full scenario suites; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused scenario for single-quoted selector keys containing doubled apostrophes and colon-bearing values to lock parity for YAML single-quote escaping edge cases.

## Iteration 3 - 2026-02-13T10:58:58Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 0
- eval_exit: 0
- pass_count: 13
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added scenario `13-quoted-selector-escaped-quotes` to lock YAML quoted-selector behavior:
  - `packages/rettangoli-check/test/scenarios/13-quoted-selector-escaped-quotes/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/13-quoted-selector-escaped-quotes/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/13-quoted-selector-escaped-quotes/src/components/card/card.schema.yaml:1`
- Hardened selector/binding parsing for tricky YAML list lines in `packages/rettangoli-check/src/core/parsers.js:3`:
  - `ATTR_REGEX` now supports escaped characters inside quoted values.
  - `stripOuterQuotes` now unescapes quoted YAML key content (`\"`, `\\`, `''`).
  - `splitYamlListLineKey` now handles escaped quotes while scanning for the YAML key/value `:` separator.
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:115`

**Why This Improves Reliability/Simplicity**
- Reliability: quoted selector lines with escaped quotes are parsed deterministically, so YAHTML diagnostics are correct (`unsupported attr`) instead of incorrect (`unknown custom element`).
- Simplicity: fix is localized to parser helpers, with behavior pinned by one focused scenario.

**Scenario Test Result**
- Ran full suite: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 13/13`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes

All scenarios passed: 13/13

## Iteration 4 - 2026-02-13T11:02:19Z
- completed changes:
  - added optional detailed diagnostics assertions to scenario runner (`test/run-scenarios.mjs`) by normalizing/sorting diagnostics and supporting `expected.diagnostics` entries (`code`, `severity`, `message`, `filePath`, `line`).
  - extended scenarios `03-forbidden-view-key` and `04-legacy-dot-prop` to assert exact diagnostic payloads including file-relative path and line number.
  - added `collectTopLevelYamlKeyLines` in `src/core/parsers.js` and wired it into the component model so forbidden top-level view keys can report precise line numbers.
  - recorded first legacy `.prop=` selector-binding line in `src/core/model.js` and used it in `RTGL-CONTRACT-003` diagnostics.
  - updated `test/README.md` to document optional detailed diagnostics assertions and current scenario count.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - extend line precision to listener diagnostics by collecting line metadata for `refs.eventListeners` entries, then lock with a scenario that asserts exact `RTGL-CHECK-LISTENER-*` locations.

## Iteration 4 - 2026-02-13T11:03:12Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 0
- eval_exit: 0
- pass_count: 13
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added optional exact diagnostic assertions in scenario tests (`code`, `severity`, `message`, `filePath`, `line`) with deterministic normalization/sorting in `packages/rettangoli-check/test/run-scenarios.mjs:40`.
- Added line capture for top-level `.view.yaml` keys via `collectTopLevelYamlKeyLines` in `packages/rettangoli-check/src/core/parsers.js:351`.
- Wired new view metadata into model build in `packages/rettangoli-check/src/core/model.js:46` and `packages/rettangoli-check/src/core/model.js:88`.
- Added `line` to:
  - `RTGL-CONTRACT-002` (forbidden view key) in `packages/rettangoli-check/src/rules/feParity.js:31`
  - `RTGL-CONTRACT-003` (legacy dot prop) in `packages/rettangoli-check/src/rules/feParity.js:43`
- Tightened scenarios to lock diagnostic quality:
  - `packages/rettangoli-check/test/scenarios/03-forbidden-view-key/expected.json:15`
  - `packages/rettangoli-check/test/scenarios/04-legacy-dot-prop/expected.json:15`
- Updated scenario-test docs in `packages/rettangoli-check/test/README.md:8`.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md:172`.

**Why This Improves Reliability/Simplicity**
- Reliability: diagnostics for two contract errors now include precise `file:line`, and scenarios now verify full diagnostic payloads (not just counts), catching message/location regressions.
- Simplicity: changes are localized to parser/model/rule plumbing and test harness; no broad rule behavior changes.

**Scenario Test Result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 13/13`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes

All scenarios passed: 13/13

## Iteration 5 - 2026-02-13T11:04:28Z
- completed changes:
  - tightened scenario `09-yahtml-unknown-attr` to assert full deterministic diagnostic payload (`code`, `severity`, `message`, `filePath`, `line`) in `test/scenarios/09-yahtml-unknown-attr/expected.json`.
  - reduced registry-generation duplication in `src/core/registry.js` by introducing `addSchemaPropsToContract` and reusing it for both UI schema contracts and project schema contracts.
  - simplified UI primitive registry assembly by introducing `mergePrimitiveContractsFromEntries` and iterating known entry files instead of duplicating sequential merge blocks.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - reduce parser fragility in registry generation by making entry import/define extraction tolerant of multiline formatting, then lock with a focused scenario.

## Iteration 5 - 2026-02-13T11:05:18Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 0
- eval_exit: 0
- pass_count: 13
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added strict diagnostic assertions for registry-driven behavior in `packages/rettangoli-check/test/scenarios/09-yahtml-unknown-attr/expected.json:15` (now checks `code`, `severity`, `message`, `filePath`, `line`).
- Reduced duplication in registry generation by extracting shared schema-prop mapping into `addSchemaPropsToContract` in `packages/rettangoli-check/src/core/registry.js:43`, then reused it in:
  - UI schema contract extraction at `packages/rettangoli-check/src/core/registry.js:80`
  - Project schema registry building at `packages/rettangoli-check/src/core/registry.js:371`
- Simplified primitive registry assembly by introducing `mergePrimitiveContractsFromEntries` in `packages/rettangoli-check/src/core/registry.js:324` and replacing duplicated entry merge blocks in `packages/rettangoli-check/src/core/registry.js:351`.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md:231`.

**Why It Improves Reliability/Simplicity**
- Reliability: scenario `09` now locks exact diagnostic payload, so regressions in registry-dependent YAHTML validation are caught precisely.
- Simplicity: shared prop-to-contract logic removes repeated code paths, and entry-file iteration removes duplicated merge flow, reducing maintenance surface without changing behavior.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 13/13`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes

All scenarios passed: 13/13

## Iteration 6 - 2026-02-13T11:08:12Z
- completed changes:
  - added scenario `14-listener-invalid-symbol` to lock listener contract behavior for invalid event `handler` symbol values and assert deterministic diagnostic payload in `test/scenarios/14-listener-invalid-symbol/expected.json`.
  - added scenario `15-schema-component-name-whitespace` to ensure schema `componentName` rejects surrounding whitespace and assert deterministic diagnostic payload in `test/scenarios/15-schema-component-name-whitespace/expected.json`.
  - introduced shared listener symbol parsing in `src/rules/listenerSymbols.js` and reused it in `src/rules/listenerConfig.js` and `src/rules/crossFileSymbols.js`.
  - added `RTGL-CHECK-LISTENER-007` for invalid listener `handler/action` symbol names and prevented invalid symbols from cascading into misleading missing-export diagnostics.
  - tightened `src/rules/schema.js` to require `componentName` without surrounding whitespace before custom-element regex validation.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - strengthen schema/listener determinism further by adding line-number attribution for listener diagnostics and locking it with scenario assertions.

## Iteration 6 - 2026-02-13T11:08:46Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 0
- eval_exit: 0
- pass_count: 15
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added two scenario tests first, then updated logic:
  - `packages/rettangoli-check/test/scenarios/14-listener-invalid-symbol/expected.json:1` (invalid listener symbol contract)
  - `packages/rettangoli-check/test/scenarios/15-schema-component-name-whitespace/expected.json:1` (schema `componentName` with surrounding whitespace)
- Added shared listener symbol validator in `packages/rettangoli-check/src/rules/listenerSymbols.js:1`.
- Updated listener contract checks in `packages/rettangoli-check/src/rules/listenerConfig.js:1`:
  - new error `RTGL-CHECK-LISTENER-007` when `handler`/`action` is not a valid symbol name.
  - `RTGL-CHECK-LISTENER-003` now triggers only when neither key is defined at all.
- Updated cross-file symbol checks in `packages/rettangoli-check/src/rules/crossFileSymbols.js:1` to only attempt export resolution for valid listener symbols (prevents misleading missing-export errors for invalid symbols).
- Tightened schema validation in `packages/rettangoli-check/src/rules/schema.js:29` to reject `componentName` values with surrounding whitespace.
- Appended iteration journal entry at `packages/rettangoli-check/.codex-journal.md:283`.

**Why This Improves Reliability/Simplicity**
- Reliability: invalid listener contracts now fail with precise contract diagnostics instead of cascading into confusing symbol-resolution errors.
- Reliability: schema `componentName` no longer silently accepts padded whitespace.
- Simplicity: one shared listener-symbol parser keeps listener and cross-file checks consistent.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 15/15`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace

All scenarios passed: 15/15

## Iteration 7 - 2026-02-13T11:11:21Z
- completed changes:
  - added scenario `16-listener-nonobject-config` with exact diagnostic assertions to lock listener behavior when `refs.*.eventListeners.*` is not an object.
  - consolidated listener symbol extraction in `src/rules/listenerSymbols.js` with new helpers `isListenerEventConfig` and `getListenerSymbols`.
  - simplified `src/rules/listenerConfig.js` by reusing the shared listener helpers and collapsing repeated option checks through `BOOLEAN_OPTIONS`/`NUMBER_OPTIONS` lists.
  - removed redundant event-config shape branching in `src/rules/crossFileSymbols.js` and reused shared listener-symbol helper output.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - continue simplifying diagnostics path resolution by extracting a shared model file-path helper used across rules to reduce repeated fallback chains and branch drift.

## Iteration 7 - 2026-02-13T11:12:17Z
- focus: Refactor for simplicity: delete dead branches and consolidate helpers.
- codex_exit: 0
- eval_exit: 0
- pass_count: 16
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a regression scenario for non-object listener config at `packages/rettangoli-check/test/scenarios/16-listener-nonobject-config/expected.json:1` (with matching fixture files under the same scenario folder) to lock deterministic behavior: only `RTGL-CHECK-LISTENER-001` is emitted.
- Consolidated listener helper logic in `packages/rettangoli-check/src/rules/listenerSymbols.js:1`:
  - added `isListenerEventConfig`
  - added `getListenerSymbols`
  - kept `getListenerSymbol` as the single parser/validator.
- Simplified listener rule flow in `packages/rettangoli-check/src/rules/listenerConfig.js:1`:
  - reused shared helper for config shape + symbol extraction
  - replaced repetitive option checks with `BOOLEAN_OPTIONS` / `NUMBER_OPTIONS` loops.
- Removed redundant event-config branch in `packages/rettangoli-check/src/rules/crossFileSymbols.js:17` by relying on shared symbol helper output.
- Appended iteration journal entry at `packages/rettangoli-check/.codex-journal.md:344`.

**Why This Improves Reliability/Simplicity**
- Reliability: the new scenario prevents regressions for malformed listener config payloads.
- Simplicity: listener parsing/validation now has one shared source of truth, reducing branch drift between rules.
- Determinism: cross-file symbol checks now consume normalized symbol results instead of duplicating config-shape logic.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 16/16`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config

All scenarios passed: 16/16

## Iteration 8 - 2026-02-13T11:13:32Z
- completed changes:
  - added scenario `17-constants-nonobject-root` with a minimal valid component plus invalid `card.constants.yaml` array root.
  - added exact diagnostic assertions in `packages/rettangoli-check/test/scenarios/17-constants-nonobject-root/expected.json` to lock `RTGL-CHECK-CONSTANTS-001` behavior and file-path determinism.
  - ran full scenario suite; all scenarios pass (`17/17`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a warning-focused scenario for `RTGL-CHECK-SYMBOL-005` (methods exported but not documented) to lock warn-only behavior and `ok: true` determinism.

## Iteration 8 - 2026-02-13T11:14:08Z
- focus: Add or improve scenario tests before changing checker logic.
- codex_exit: 0
- eval_exit: 0
- pass_count: 17
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new scenario test `packages/rettangoli-check/test/scenarios/17-constants-nonobject-root/expected.json:1` that asserts exact output for invalid `.constants.yaml` root shape (`RTGL-CHECK-CONSTANTS-001`).
- Added minimal fixture files for that scenario:
  - `packages/rettangoli-check/test/scenarios/17-constants-nonobject-root/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/17-constants-nonobject-root/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/17-constants-nonobject-root/src/components/card/card.constants.yaml:1`
- Appended iteration journal entry at `packages/rettangoli-check/.codex-journal.md:405`.

**Why It Improves Reliability/Simplicity**
- Reliability: this locks deterministic behavior for constants-root validation with exact code/message/path expectations.
- Simplicity: no checker logic changes were needed; this is a focused regression guard for an existing rule path.

**Scenario Test Result**
- Ran `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: all scenarios passed, `17/17` (including new `17-constants-nonobject-root`).
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root

All scenarios passed: 17/17

## Iteration 9 - 2026-02-13T11:18:17Z
- completed changes:
  - tightened CLI argument handling in `src/cli/bin.js` with strict parsing and deterministic failures for unknown options, missing flag values, and invalid `--format` values.
  - added stable CLI usage/help text and explicit `CliArgError` handling so argument errors return exit code `1` without stack traces.
  - extended `test/run-scenarios.mjs` to support `mode: "cli"` scenarios (exit code, stdout/stderr assertions, and JSON subset assertions).
  - added CLI scenarios:
    - `18-cli-unknown-flag` (unknown option fails with deterministic stderr usage output)
    - `19-cli-text-error-stderr` (checker errors in text mode go to stderr with exit code `1`)
    - `20-cli-json-success` (JSON mode emits structured JSON on stdout with exit code `0`)
  - updated `test/README.md` to document CLI scenario mode and scenario index (`20` total).
  - ran full scenario suite; all scenarios pass (`20/20`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a CLI scenario for `--warn-as-error` to lock warn-only project behavior (`ok: true` analysis vs exit code `1` in CLI mode) and make warning exit semantics fully deterministic.

## Iteration 9 - 2026-02-13T11:18:49Z
- focus: Make CLI behavior predictable: flags, exits, and output format.
- codex_exit: 0
- eval_exit: 0
- pass_count: 20
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Tightened CLI parsing and error handling in `packages/rettangoli-check/src/cli/bin.js:4`:
  - strict flag parsing (`--dir`/`--dirs`, `--format`, `--warn-as-error`, `--no-yahtml`, `--help`)
  - deterministic failures for unknown options, missing values, invalid `--format`
  - stable usage text and clean exit `1` for arg errors (no stack trace)
- Extended scenario runner to test CLI behavior in `packages/rettangoli-check/test/run-scenarios.mjs:3`:
  - added `mode: "cli"` scenarios via `spawnSync`
  - assertions for exit code, stdout/stderr, includes, and JSON subset matching
- Added new CLI scenarios:
  - `packages/rettangoli-check/test/scenarios/18-cli-unknown-flag/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/19-cli-text-error-stderr/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/20-cli-json-success/expected.json:1`
- Updated scenario docs in `packages/rettangoli-check/test/README.md:8`.
- Appended Iteration 9 journal entry in `packages/rettangoli-check/.codex-journal.md:460`.

**Why This Improves Reliability/Simplicity**
- Removes silent CLI ambiguity (unknown/malformed flags now fail predictably).
- Locks stream/exit semantics with tests (`text` errors on `stderr`, `json` output on `stdout`).
- Keeps changes small and deterministic by adding scenario coverage first, then minimal CLI logic hardening.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` (from `packages/rettangoli-check`)
- Result: all scenarios passed, `20/20`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout

All scenarios passed: 20/20

## Iteration 10 - 2026-02-13T11:20:35Z
- completed changes:
  - added scenario `21-warn-only-method-undocumented` to lock warn-only analyzer behavior (`ok: true`, `warnCount: 1`) for `RTGL-CHECK-SYMBOL-005` when `.methods.js` exports an undocumented method.
  - added scenario `22-cli-warn-as-error` to lock CLI warning escalation semantics (`--warn-as-error`): warning-only project exits with code `1`, emits text report on `stderr`, and renders the warning diagnostic as `[error]`.
  - updated `test/README.md` scenario index/count from `20` to `22`.
  - ran full scenario suite; all scenarios pass (`22/22`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused CLI JSON scenario for `--warn-as-error` to pin `warnAsError: true` reporting (`ok` field semantics + summary invariants) alongside exit-code behavior.

## Iteration 10 - 2026-02-13T11:21:16Z
- focus: Prioritize maintainability: minimal code, maximal signal.
- codex_exit: 0
- eval_exit: 0
- pass_count: 22
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added warning-baseline scenario: `packages/rettangoli-check/test/scenarios/21-warn-only-method-undocumented/expected.json` (plus fixture files) to lock analyzer behavior for warn-only projects:
  - `ok: true`
  - `warnCount: 1`
  - `RTGL-CHECK-SYMBOL-005` exact diagnostic
- Added CLI warning-escalation scenario: `packages/rettangoli-check/test/scenarios/22-cli-warn-as-error/expected.json` (plus fixture files) to lock `--warn-as-error` behavior:
  - warning-only project exits with `1`
  - text report goes to `stderr`
  - warning is rendered as `[error]` in text output
- Updated scenario docs/count in `packages/rettangoli-check/test/README.md`.
- Appended Iteration 10 journal entry to `packages/rettangoli-check/.codex-journal.md` with timestamp, completed changes, blockers, and next-step hypothesis.

**Why this improves reliability/simplicity**
- Reliability: warn semantics are now explicitly pinned in both analyzer and CLI paths, preventing regressions in `ok`/exit-code behavior.
- Simplicity: no checker logic changes were needed; this iteration adds focused, deterministic coverage with minimal surface area.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 22/22`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project

All scenarios passed: 22/22

## Iteration 11 - 2026-02-13T11:24:47Z
- completed changes:
  - added scenario `23-yahtml-generic-camelcase-attrs` with fixture files to lock camelCase generic attr handling on custom elements (`tabIndex`, `contentEditable`, `ariaLabel`, `dataTestId`).
  - updated `src/rules/yahtmlAttrs.js` generic attr matching to normalize and accept safe aliases (`raw`, `lowercase`, `kebab-case`, compact-lower) before allowlist/prefix checks.
  - updated scenario docs/count in `test/README.md` from `22` to `23`.
  - ran full scenario suite; all scenarios pass (`23/23`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a negative YAHTML scenario to ensure near-miss camelCase tokens (for example `ariaLabelled`) still fail, to guard against over-permissive normalization.

## Iteration 11 - 2026-02-13T11:25:10Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 23
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added new scenario `23-yahtml-generic-camelcase-attrs`:
  - `packages/rettangoli-check/test/scenarios/23-yahtml-generic-camelcase-attrs/expected.json`
  - `packages/rettangoli-check/test/scenarios/23-yahtml-generic-camelcase-attrs/src/components/card/card.schema.yaml`
  - `packages/rettangoli-check/test/scenarios/23-yahtml-generic-camelcase-attrs/src/components/card/card.view.yaml`
- Updated YAHTML generic-attr normalization in `packages/rettangoli-check/src/rules/yahtmlAttrs.js`:
  - generic checks now consider safe normalized forms (`raw`, lowercase, kebab-case, compact-lower) so camelCase variants like `tabIndex`, `contentEditable`, `ariaLabel`, `dataTestId` are accepted.
- Updated scenario index/count in `packages/rettangoli-check/test/README.md` to 23 scenarios.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md` with iteration number, timestamp, completed changes, blockers, and next-step hypothesis.

**Why this improves reliability/simplicity**
- Reliability: locks a real YAHTML attr coverage gap with a deterministic scenario, then fixes it with narrow normalization logic.
- Simplicity: keeps contract matching unchanged and only broadens generic attr handling in a controlled way, minimizing false-positive risk.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (from `packages/rettangoli-check`)
- Result: `All scenarios passed: 23/23`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants

All scenarios passed: 23/23

## Iteration 12 - 2026-02-13T11:27:50Z
- completed changes:
  - added scenario `24-method-default-export-direct` to lock cross-file method-symbol behavior when `.methods.js` uses direct default export syntax.
  - updated `src/core/parsers.js` `extractNamedExports` to detect direct `export default` and include `default` in extracted symbols.
  - updated `test/README.md` scenario count/list from `23` to `24`.
  - ran full scenario suite; all scenarios pass (`24/24`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused cross-file scenario for handlers/actions that validates aliased re-exports (`export { fn as alias } from ...`) to further harden symbol resolution coverage.

## Iteration 12 - 2026-02-13T11:28:27Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 24
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario to lock cross-file method symbol behavior for direct default exports:
  - `packages/rettangoli-check/test/scenarios/24-method-default-export-direct/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/24-method-default-export-direct/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/24-method-default-export-direct/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/24-method-default-export-direct/src/components/card/card.methods.js:1`
- Hardened export extraction to detect direct `export default` and include `"default"` in symbol extraction:
  - `packages/rettangoli-check/src/core/parsers.js:103`
- Updated scenario docs/count:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration 12 journal entry (timestamp, completed changes, blockers, next-step hypothesis):
  - `packages/rettangoli-check/.codex-journal.md:661`

**Why this improves reliability/simplicity**
- Reliability: `.methods.js` direct default exports now consistently trigger `RTGL-CHECK-SYMBOL-004` instead of silently missing that check.
- Simplicity: change is minimal and localized to `extractNamedExports`, with behavior pinned by one focused scenario.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (from `packages/rettangoli-check`)
- Result: `All scenarios passed: 24/24`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export

All scenarios passed: 24/24

## Iteration 13 - 2026-02-13T11:30:37Z
- completed changes:
  - added scenario `25-list-lines-outside-template` to reproduce false selector parsing from YAML list mappings outside `template` (e.g. `styles.tokens` keys like `style-token`).
  - updated `src/core/parsers.js` `collectSelectorBindingsFromViewText` to track current top-level YAML key and only collect selector bindings while inside top-level `template`.
  - updated `test/README.md` scenario count/list from `24` to `25`.
  - ran full scenario suite; all scenarios pass (`25/25`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a targeted scenario for quoted top-level `template` key (`"template":`) with selector list lines to ensure the new top-level key gating remains robust across quoted-key YAML styles.

## Iteration 13 - 2026-02-13T11:31:07Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 0
- eval_exit: 0
- pass_count: 25
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new failing-then-passing scenario for this parser edge case:
  - `packages/rettangoli-check/test/scenarios/25-list-lines-outside-template/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/25-list-lines-outside-template/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/25-list-lines-outside-template/src/components/card/card.schema.yaml:1`
- Fixed selector-line extraction to only run while inside top-level `template`:
  - `packages/rettangoli-check/src/core/parsers.js:320`
- Updated scenario index/count:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration 13 journal entry:
  - `packages/rettangoli-check/.codex-journal.md:729`

**Why this improves reliability/simplicity**
- Reliability: avoids false `RTGL-CHECK-YAHTML-001` errors caused by hyphenated list keys outside `template` (for example under `styles`).
- Simplicity: minimal, deterministic change (top-level key gating) without altering rule logic or diagnostics format.

**Scenario test result**
- Ran `node ./test/run-scenarios.mjs` from `packages/rettangoli-check`.
- Result: `All scenarios passed: 25/25`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored

All scenarios passed: 25/25

## Iteration 14 - 2026-02-13T11:32:32Z
- completed changes:
  - added scenario `26-schema-parse-error-line` to lock YAML parse diagnostic quality (stable message + file:line precision) for schema parse failures.
  - updated `src/core/parsers.js` `parseYamlSafe` to emit `RTGL-CHECK-PARSE-001` with a deterministic reason-based message (`err.reason`) and `line` from YAML parser mark data.
  - updated `test/README.md` scenario count/list from `25` to `26`.
  - ran full scenario suite; all scenarios pass (`26/26`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add line-precision support for listener diagnostics by mapping `refs.<ref>.eventListeners.<event>` YAML paths to source lines, then cover with targeted scenarios.

## Iteration 14 - 2026-02-13T11:33:03Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 0
- eval_exit: 0
- pass_count: 26
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario that locks parse-diagnostic quality for invalid YAML:
  - `packages/rettangoli-check/test/scenarios/26-schema-parse-error-line/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/26-schema-parse-error-line/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/26-schema-parse-error-line/src/components/card/card.view.yaml:1`
- Tightened YAML parse diagnostics in `parseYamlSafe`:
  - `packages/rettangoli-check/src/core/parsers.js:8`
  - `RTGL-CHECK-PARSE-001` now uses a deterministic reason-based message (`err.reason`) and sets `line` from YAML parser mark data.
- Updated scenario docs count/list:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry (iteration 14, timestamp, changes, blockers, next-step hypothesis):
  - `packages/rettangoli-check/.codex-journal.md:797`

**Why this improves reliability/simplicity**
- Reliability: parse errors now consistently include `filePath` + exact `line`, improving pinpointing and reducing ambiguity.
- Simplicity: one localized parser change, with behavior pinned by a focused scenario test.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (from `packages/rettangoli-check`)
- Result: `All scenarios passed: 26/26`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line

All scenarios passed: 26/26

## Iteration 15 - 2026-02-13T11:35:08Z
- completed changes:
  - added scenario `27-project-schema-registry-cross-component` to lock cross-component project schema registry behavior (known custom element + props-derived attr/prop acceptance).
  - updated `src/core/registry.js` to extract shared `addSchemaContractToRegistry` logic and reuse it in both UI schema contract extraction and project schema registry generation.
  - preserved existing componentName acceptance rules for each path (`ui-components`: non-empty string, `project-schema`: non-whitespace string) to avoid behavior drift.
  - updated `test/README.md` scenario count/list from `26` to `27`.
  - ran full scenario suite; all scenarios pass (`27/27`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - simplify primitive contract extraction by separating parsing from dynamic import execution, then pin current behavior with a targeted scenario around primitive attr discovery fallback.

## Iteration 15 - 2026-02-13T11:35:43Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 0
- eval_exit: 0
- pass_count: 27
- notes: ok

### Last Codex Message (tail)
No listed skill applied this turn (`skill-creator`/`skill-installer` are not relevant to this refactor task).

**What changed**
- Added a new scenario to pin project-schema registry behavior across components:
  - `packages/rettangoli-check/test/scenarios/27-project-schema-registry-cross-component/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/27-project-schema-registry-cross-component/src/components/host/host.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/27-project-schema-registry-cross-component/src/components/child/child.schema.yaml:1`
- Reduced registry-generation duplication by extracting shared schema-contract insertion logic:
  - New helper `addSchemaContractToRegistry` in `packages/rettangoli-check/src/core/registry.js:43`
  - Reused in UI schema extraction at `packages/rettangoli-check/src/core/registry.js:89`
  - Reused in project schema registry generation at `packages/rettangoli-check/src/core/registry.js:380`
- Kept existing acceptance behavior intact:
  - UI path still accepts non-empty string (`componentName !== ""`) at `packages/rettangoli-check/src/core/registry.js:93`
  - Project path still requires non-whitespace string (`componentName.trim() !== ""`) at `packages/rettangoli-check/src/core/registry.js:384`
- Updated scenario docs count/list:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:867`

**Why this improves reliability/simplicity**
- Simplicity: one shared code path now builds schema-derived contracts, reducing duplicated logic in registry generation.
- Reliability: behavior-critical path is now pinned by a targeted scenario that validates cross-component contract resolution and prop/attr acceptance.

**Scenario test result**
- Ran `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 27/27`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component

All scenarios passed: 27/27

## Iteration 16 - 2026-02-13T11:37:54Z
- completed changes:
  - added scenario `28-schema-contract-nonobject-properties` to pin schema-contract behavior when `propsSchema.properties` is not an object.
  - scenario asserts malformed schema shapes do not silently allow unsupported bindings (host binding `0=...` now reports `RTGL-CHECK-YAHTML-003`).
  - hardened schema contract extraction in `src/core/registry.js`:
    - only reads `propsSchema.properties` when it is an object record (ignores arrays/non-objects).
    - ignores empty or whitespace-padded property keys while building attrs/props contracts.
  - updated scenario docs count/list in `test/README.md` from `27` to `28`.
  - ran full scenario suite; all scenarios pass (`28/28`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a listener-focused scenario for malformed option contracts (for example unknown option keys) and decide whether to enforce a strict listener option allowlist to catch configuration typos earlier.

## Iteration 16 - 2026-02-13T11:38:25Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 0
- eval_exit: 0
- pass_count: 28
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario to lock schema-contract behavior for malformed `propsSchema.properties`:
  - `packages/rettangoli-check/test/scenarios/28-schema-contract-nonobject-properties/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/28-schema-contract-nonobject-properties/src/components/child/child.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/28-schema-contract-nonobject-properties/src/components/host/host.view.yaml:1`
- Hardened schema contract extraction in `packages/rettangoli-check/src/core/registry.js:43` and `packages/rettangoli-check/src/core/registry.js:63`:
  - only reads `propsSchema.properties` when it is an object record
  - ignores empty or whitespace-padded prop keys
- Updated scenario docs count/list in `packages/rettangoli-check/test/README.md:22`.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md:945`.

**Why this improves reliability/simplicity**
- Prevents malformed schema shapes (like array `properties`) from silently widening allowed attr/prop contracts.
- Keeps contract building deterministic with a small, localized guard in one place.

**Scenario test result**
- Ran `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: `All scenarios passed: 28/28`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties

All scenarios passed: 28/28

## Iteration 17 - 2026-02-13T11:41:47Z
- completed changes:
  - added scenario `29-listener-option-type-validation` to lock listener option validation behavior for boolean/number options and debounce+throttle conflict.
  - refactored `src/rules/listenerConfig.js` to consolidate option checks into one generic validator helper (`validateOptionValue`) and one numeric predicate (`isNonNegativeNumber`).
  - removed duplicated option-validation branches from dedicated boolean/number helper functions while preserving the same diagnostic codes/messages.
  - updated scenario docs count/list in `test/README.md` from `28` to `29`.
  - ran full scenario suite; all scenarios pass (`29/29`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - extract a shared `isObjectRecord` utility used across rules/core modules to reduce repeated shape guards and make future contract-related checks easier to maintain.

## Iteration 17 - 2026-02-13T11:42:29Z
- focus: Refactor for simplicity: delete dead branches and consolidate helpers.
- codex_exit: 0
- eval_exit: 0
- pass_count: 29
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new regression scenario for listener option validation:
  - `packages/rettangoli-check/test/scenarios/29-listener-option-type-validation/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/29-listener-option-type-validation/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/29-listener-option-type-validation/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/29-listener-option-type-validation/src/components/card/card.handlers.js:1`
- Refactored listener option checking to consolidate helpers:
  - replaced separate boolean/number assertion helpers with shared `validateOptionValue` and `isNonNegativeNumber` in `packages/rettangoli-check/src/rules/listenerConfig.js:16`
  - kept all listener diagnostic codes/messages unchanged (`001`-`007` behavior preserved)
- Updated scenario docs to include scenario 29:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1018`

**Why this improves reliability/simplicity**
- Reliability: the new scenario locks current listener option-type behavior (`RTGL-CHECK-LISTENER-004/005/006`) so future refactors can’t silently regress it.
- Simplicity: listener option validation now uses one generic path instead of duplicated boolean/number helper branches, reducing maintenance surface.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (from `packages/rettangoli-check`)
- Result: `All scenarios passed: 29/29`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation

All scenarios passed: 29/29

## Iteration 18 - 2026-02-13T11:43:41Z
- completed changes:
  - added scenario `30-listener-option-valid-values` covering valid listener boolean options (`preventDefault`, `stopPropagation`, `stopImmediatePropagation`, `targetOnly`, `once`) and valid numeric options (`debounce: 0`, `throttle: 120`) with handler wiring.
  - added scenario fixtures:
    - `test/scenarios/30-listener-option-valid-values/expected.json`
    - `test/scenarios/30-listener-option-valid-values/src/components/card/card.schema.yaml`
    - `test/scenarios/30-listener-option-valid-values/src/components/card/card.view.yaml`
    - `test/scenarios/30-listener-option-valid-values/src/components/card/card.handlers.js`
  - updated scenario docs count/list in `test/README.md` from `29` to `30`.
  - ran full scenario suite; all scenarios pass (`30/30`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused scenario asserting listener option behavior for YAML special numeric literals (`.inf`, `.nan`) so non-finite values remain explicitly rejected.

## Iteration 18 - 2026-02-13T11:44:20Z
- focus: Add or improve scenario tests before changing checker logic.
- codex_exit: 0
- eval_exit: 0
- pass_count: 30
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario: `packages/rettangoli-check/test/scenarios/30-listener-option-valid-values/expected.json:1`
- Added scenario fixtures:
  - `packages/rettangoli-check/test/scenarios/30-listener-option-valid-values/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/30-listener-option-valid-values/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/30-listener-option-valid-values/src/components/card/card.handlers.js:1`
- Updated scenario docs count/list to 30:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry (iteration 18 + timestamp + changes/blockers/next step):
  - `packages/rettangoli-check/.codex-journal.md:1093`

**Why this improves reliability/simplicity**
- Reliability: this locks the valid-path behavior for listener options (all boolean flags, `debounce: 0`, and `throttle`), so future refactors can’t accidentally reject correct configs.
- Simplicity: no checker logic changes were needed; only scenario coverage was extended in a focused, deterministic way.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 30/30`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values

All scenarios passed: 30/30

## Iteration 19 - 2026-02-13T11:45:44Z
- completed changes:
  - added CLI scenario `31-cli-help-precedence` to lock deterministic help behavior when mixed with invalid flags (`--unknown --help`).
  - updated `src/cli/bin.js` argument parsing so `--help` / `-h` takes global precedence regardless of argument order.
  - updated scenario docs count/list in `test/README.md` from `30` to `31`.
  - ran full scenario suite; all scenarios pass (`31/31`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a CLI scenario asserting `--format json` with failing diagnostics still writes JSON to `stdout` (with empty `stderr`) and returns exit code `1`.

## Iteration 19 - 2026-02-13T11:46:23Z
- focus: Make CLI behavior predictable: flags, exits, and output format.
- codex_exit: 0
- eval_exit: 0
- pass_count: 31
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new CLI scenario `packages/rettangoli-check/test/scenarios/31-cli-help-precedence/expected.json:1` that asserts `--unknown --help` returns usage on `stdout`, empty `stderr`, and exit `0`.
- Updated CLI arg parsing in `packages/rettangoli-check/src/cli/bin.js:31` so `--help` / `-h` is handled with global precedence, independent of flag order.
- Updated scenario docs/count in `packages/rettangoli-check/test/README.md:22` and `packages/rettangoli-check/test/README.md:54`.
- Appended iteration 19 journal entry in `packages/rettangoli-check/.codex-journal.md:1169`.

**Why this improves reliability/simplicity**
- CLI behavior is now deterministic for help handling: same result regardless of argument ordering.
- The behavior is locked by a scenario test, reducing regression risk.
- Change is minimal and localized to argument parsing plus test/docs updates.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (in `packages/rettangoli-check`)
- Result: `All scenarios passed: 31/31`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args

All scenarios passed: 31/31

## Iteration 20 - 2026-02-13T11:47:31Z
- completed changes:
  - added CLI scenario `32-cli-json-error-stdout` to assert failing checks with `--format json` return exit code `1`, emit JSON on `stdout`, and keep `stderr` empty.
  - added scenario fixture file at `test/scenarios/32-cli-json-error-stdout/src/components/card/card.view.yaml` (missing schema case).
  - updated scenario docs count/list in `test/README.md` from `31` to `32`.
  - ran full scenario suite; all scenarios pass (`32/32`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a CLI scenario verifying `--warn-as-error --format json` keeps JSON shape stable while flipping `ok` to `false` on warning-only projects.

## Iteration 20 - 2026-02-13T11:48:01Z
- focus: Prioritize maintainability: minimal code, maximal signal.
- codex_exit: 0
- eval_exit: 0
- pass_count: 32
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new CLI scenario: `packages/rettangoli-check/test/scenarios/32-cli-json-error-stdout/expected.json` and fixture `packages/rettangoli-check/test/scenarios/32-cli-json-error-stdout/src/components/card/card.view.yaml`.
- Updated scenario docs/count to 32 in `packages/rettangoli-check/test/README.md`.
- Appended iteration 20 journal entry (with timestamp, changes, blockers, next-step hypothesis) in `packages/rettangoli-check/.codex-journal.md`.

**Why this improves reliability/simplicity**
- Locks a deterministic CLI contract for failure mode with `--format json`: exit `1`, JSON on `stdout`, empty `stderr`.
- Test-only change to behavior surface (no logic edits), so maintainability improves with minimal risk.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (in `packages/rettangoli-check`)
- Result: `All scenarios passed: 32/32`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout

All scenarios passed: 32/32

## Iteration 21 - 2026-02-13T11:51:36Z
- completed changes:
  - added scenario `33-yahtml-global-popover-attr` to cover `popover=auto` on a custom element (`rtgl-button`) in YAHTML templates.
  - expanded YAHTML generic attribute allowlist in `src/rules/yahtmlAttrs.js` by adding `popover`.
  - updated scenario docs/count to 33 in `test/README.md`.
  - ran the full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add focused YAHTML scenarios for additional modern-but-low-risk global attrs (`itemprop`/`itemscope`) and only allow those that are validated by scenario-first evidence.

## Iteration 21 - 2026-02-13T11:52:08Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 33
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added scenario `33-yahtml-global-popover-attr` to lock YAHTML support for `popover=auto` on a custom element:
  - `packages/rettangoli-check/test/scenarios/33-yahtml-global-popover-attr/src/components/card/card.view.yaml:2`
  - `packages/rettangoli-check/test/scenarios/33-yahtml-global-popover-attr/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/33-yahtml-global-popover-attr/expected.json:1`
- Expanded the YAHTML generic attr allowlist with `popover`:
  - `packages/rettangoli-check/src/rules/yahtmlAttrs.js:20`
- Updated scenario docs/count to 33:
  - `packages/rettangoli-check/test/README.md:22`
  - `packages/rettangoli-check/test/README.md:56`
- Appended iteration 21 journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1306`

**Why this improves reliability/simplicity**
- Improves YAHTML attr coverage for a standard global HTML attribute without broad rule relaxation.
- Keeps false positives low by adding a single standards-based attr and locking behavior with a scenario-first test.
- Change is minimal and deterministic (one allowlist addition + one focused scenario).

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 33/33`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr

All scenarios passed: 33/33

## Iteration 22 - 2026-02-13T11:55:15Z
- completed changes:
  - added scenario `34-cross-file-symbol-multi-export-declarators` that references the second declarator in comma-separated exports for `.handlers.js`, `.store.js`, and `.methods.js`.
  - updated export parsing in `src/core/parsers.js` to collect all top-level declarator names from `export const/let/var` statements instead of only the first one.
  - kept list-export parsing strict to identifier-like aliases and split class export handling from variable declaration handling.
  - updated scenario docs/count to 34 in `test/README.md`.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused scenario for `export function*` and for `export * as name from` to verify cross-file symbol extraction remains robust for less common export forms.

## Iteration 22 - 2026-02-13T11:56:13Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 34
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added scenario `34-cross-file-symbol-multi-export-declarators` to lock behavior where referenced handler/action/method symbols are the second declarator in comma-separated exports:
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/src/components/card/card.handlers.js:1`
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/src/components/card/card.store.js:1`
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/src/components/card/card.methods.js:1`
  - `packages/rettangoli-check/test/scenarios/34-cross-file-symbol-multi-export-declarators/expected.json:1`
- Strengthened export extraction so `export const/let/var a = ..., b = ...` collects all top-level declarator names (not just the first), used by cross-file symbol checks:
  - `packages/rettangoli-check/src/core/parsers.js:109`
  - `packages/rettangoli-check/src/core/parsers.js:169`
  - `packages/rettangoli-check/src/core/parsers.js:261`
- Updated scenario docs count/list to 34:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration 22 journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1384`

**Why this improves reliability/simplicity**
- Removes a deterministic false-negative in symbol extraction that caused false missing-symbol errors for valid comma-separated exports in handlers/actions/methods.
- Keeps logic simple and local to one parser path, with scenario coverage guarding regressions.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 34/34`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators

All scenarios passed: 34/34

## Iteration 23 - 2026-02-13T12:00:30Z
- completed changes:
  - added scenario `35-selector-quoted-flow-value-colon` to cover a quoted selector key containing a flow-style attr value with internal `:` spacing (`config={ foo: bar }`), asserting no false YAHTML attr errors.
  - replaced regex-based attribute token parsing with top-level whitespace tokenization in `parseBindingNames`, so spaces/colons inside quoted or bracketed attr values no longer leak extra pseudo-bindings.
  - tightened selector splitting to use first whitespace (not only literal space), improving robustness for selector lines using tabs or mixed spacing.
  - updated scenario docs count/list to 35 in `test/README.md`.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a follow-up selector parser scenario for bracketed/parenthesized attr expressions that include nested quotes and escaped characters, to lock in tokenizer behavior at depth boundaries.

## Iteration 23 - 2026-02-13T12:01:09Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 0
- eval_exit: 0
- pass_count: 35
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new regression scenario for tricky selector/list parsing with flow-style attr values containing `:`:
  - `packages/rettangoli-check/test/scenarios/35-selector-quoted-flow-value-colon/src/components/card/card.view.yaml:1`
  - `packages/rettangoli-check/test/scenarios/35-selector-quoted-flow-value-colon/src/components/card/card.schema.yaml:1`
  - `packages/rettangoli-check/test/scenarios/35-selector-quoted-flow-value-colon/expected.json:1`
- Updated selector/binding parsing to be depth-aware for attr tokenization (so values like `config={ foo: bar }` no longer leak fake bindings like `foo:`/`bar`/`}`):
  - `packages/rettangoli-check/src/core/parsers.js:413`
  - `packages/rettangoli-check/src/core/parsers.js:505`
- Tightened selector split logic to use first whitespace (not only literal spaces), improving deterministic parsing on mixed whitespace:
  - `packages/rettangoli-check/src/core/parsers.js:390`
- Updated scenario docs count/list:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration 23 journal entry with timestamp, completed changes, blockers, and next-step hypothesis:
  - `packages/rettangoli-check/.codex-journal.md:1467`

**Why this improves reliability/simplicity**
- Eliminates deterministic false-positive YAHTML attr diagnostics caused by regex token leakage from complex attr values.
- Uses a single, explicit top-level tokenizer path for bindings, which is simpler to reason about than regex+replacement passes.
- Locks behavior with a focused scenario so this edge case stays covered.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 35/35`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon

All scenarios passed: 35/35

## Iteration 24 - 2026-02-13T12:04:56Z
- completed changes:
  - tightened listener-related diagnostics to include deterministic `line` locations from `card.view.yaml` by deriving nested YAML key-path line maps (`refs.<ref>.eventListeners.<event>[.<option>]`) during model build.
  - threaded listener line metadata into listener config rules and cross-file symbol rules, with stable fallback order: specific option key line -> event key line.
  - updated scenario expectations to lock line precision for listener/symbol diagnostics:
    - `05-missing-handler-export`
    - `06-missing-action-export`
    - `08-listener-both-handler-action`
    - `14-listener-invalid-symbol`
    - `16-listener-nonobject-config`
    - `29-listener-option-type-validation`
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - extend file:line precision to schema-method symbol mismatches (`RTGL-CHECK-SYMBOL-003`) by capturing nested schema key-path lines for `methods.properties.<name>` and emitting those lines in diagnostics.

## Iteration 24 - 2026-02-13T12:05:54Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 0
- eval_exit: 0
- pass_count: 35
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added deterministic YAML key-path line indexing for view files, then attached listener event/option lines to parsed listener records:
  - `packages/rettangoli-check/src/core/parsers.js:604`
  - `packages/rettangoli-check/src/core/parsers.js:610`
  - `packages/rettangoli-check/src/core/parsers.js:642`
  - `packages/rettangoli-check/src/core/model.js:3`
  - `packages/rettangoli-check/src/core/model.js:53`
  - `packages/rettangoli-check/src/core/model.js:91`
  - `packages/rettangoli-check/src/core/model.js:106`
- Threaded precise `line` emission into listener diagnostics (`RTGL-CHECK-LISTENER-001..007`) and cross-file listener symbol diagnostics (`RTGL-CHECK-SYMBOL-001/002`), preferring option-key line and falling back to event line:
  - `packages/rettangoli-check/src/rules/listenerConfig.js:20`
  - `packages/rettangoli-check/src/rules/listenerConfig.js:63`
  - `packages/rettangoli-check/src/rules/crossFileSymbols.js:11`
  - `packages/rettangoli-check/src/rules/crossFileSymbols.js:37`
- Tightened scenario expectations to assert file:line precision for affected diagnostics:
  - `packages/rettangoli-check/test/scenarios/05-missing-handler-export/expected.json:17`
  - `packages/rettangoli-check/test/scenarios/06-missing-action-export/expected.json:17`
  - `packages/rettangoli-check/test/scenarios/08-listener-both-handler-action/expected.json:17`
  - `packages/rettangoli-check/test/scenarios/14-listener-invalid-symbol/expected.json:17`
  - `packages/rettangoli-check/test/scenarios/16-listener-nonobject-config/expected.json:17`
  - `packages/rettangoli-check/test/scenarios/29-listener-option-type-validation/expected.json:19`
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1550`

**Why this improves reliability/simplicity**
- Keeps existing diagnostic codes stable while improving source precision (`filePath` + `line`) for listener-related failures.
- Uses a single deterministic fallback policy for line selection (option line, then event line), making output more predictable and easier to debug.
- Locks behavior with scenario assertions so future refactors don’t regress diagnostic location quality.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` (in `packages/rettangoli-check`)
- Result: `All scenarios passed: 35/35`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon

All scenarios passed: 35/35

## Iteration 25 - 2026-02-13T12:08:33Z
- completed changes:
  - added scenario `36-project-schema-registry-augments-ui-tag` to lock merged-registry behavior where project schema props augment an existing UI tag contract (`rtgl-text`) while preserving UI-provided attrs.
  - reduced registry generation complexity in `src/core/registry.js` by introducing `mergeRegistryMaps(registries)` as a single deterministic merge path for registry maps.
  - replaced side-effecting primitive merge helper with pure `collectPrimitiveContractsFromEntries({ uiDir, globalStyleAttrs })`, then merged component+primitive contracts in one place.
  - simplified `buildUiRegistry` and `buildMergedRegistry` to return merged maps directly via shared merge helper.
  - ran full scenario suite; all scenarios pass.
- blockers encountered:
  - none.
- next-step hypothesis:
  - further reduce `registry.js` complexity by extracting source parsing utilities (`parseEntryImports`, `parseCustomElementDefines`, `extractTopLevelObjectKeys`) into a dedicated parser module with focused tests, keeping registry assembly orchestration-only.

## Iteration 25 - 2026-02-13T12:23:41Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 0
- eval_exit: 0
- pass_count: 36
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario to lock merged-registry behavior: `packages/rettangoli-check/test/scenarios/36-project-schema-registry-augments-ui-tag/expected.json:1` (with fixture usage in `packages/rettangoli-check/test/scenarios/36-project-schema-registry-augments-ui-tag/src/components/host/host.view.yaml:1`).
- Simplified registry generation in `packages/rettangoli-check/src/core/registry.js`:
  - Added a single shared merge helper `mergeRegistryMaps` (`packages/rettangoli-check/src/core/registry.js:89`).
  - Replaced side-effecting primitive merge with pure collector `collectPrimitiveContractsFromEntries` (`packages/rettangoli-check/src/core/registry.js:360`).
  - Simplified `buildUiRegistry` and `buildMergedRegistry` to return merged maps directly through the shared helper (`packages/rettangoli-check/src/core/registry.js:375`, `packages/rettangoli-check/src/core/registry.js:413`).
- Appended iteration journal entry: `packages/rettangoli-check/.codex-journal.md:1647`.

**Why this improves reliability/simplicity**
- Registry assembly now has one deterministic merge path instead of multiple mutation points.
- Primitive contract aggregation is now pure, which reduces side effects and makes behavior easier to reason about.
- The new scenario explicitly protects UI+project contract union behavior during future refactors.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 36/36`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag

All scenarios passed: 36/36

## Iteration 26 - 2026-02-13T12:25:27Z
- completed changes:
  - added scenario `37-listener-unknown-option` to assert listener contract rejects unknown event option keys with stable line mapping.
  - updated `src/rules/listenerConfig.js` to enforce an explicit allowlist of listener options (`handler`, `action`, boolean options, and numeric options).
  - introduced diagnostic `RTGL-CHECK-LISTENER-008` for unknown listener option keys.
  - ran full scenario suite; all scenarios pass (`37/37`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - strengthen schema contract reliability by adding scenario-backed validation that `schema.methods.properties` keys must be valid method symbol names, preventing ambiguous cross-file method-contract errors.

## Iteration 26 - 2026-02-13T12:26:04Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 0
- eval_exit: 0
- pass_count: 37
- notes: ok

### Last Codex Message (tail)
Implemented a small scenario-first reliability improvement for listener contracts.

**What changed**
- Added scenario `37-listener-unknown-option` to lock behavior for typo/unknown listener options:
  - `packages/rettangoli-check/test/scenarios/37-listener-unknown-option/expected.json:1`
  - `packages/rettangoli-check/test/scenarios/37-listener-unknown-option/src/components/card/card.view.yaml:1`
- Updated listener config validation to enforce an explicit allowlist of listener keys and report unknown ones with a new deterministic diagnostic:
  - `packages/rettangoli-check/src/rules/listenerConfig.js:16`
  - `packages/rettangoli-check/src/rules/listenerConfig.js:87`
  - New code: `RTGL-CHECK-LISTENER-008`
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1724`

**Why this improves reliability/simplicity**
- Unknown listener keys (for example typos like `preventDefualt`) no longer silently pass.
- Listener contract is now explicit and deterministic: only known keys are accepted.
- The new scenario prevents regressions in this contract check.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 37/37`
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option

All scenarios passed: 37/37

## Iteration 27 - 2026-02-13T12:28:25Z
- completed changes:
  - consolidated duplicate listener diagnostic line resolution into a single shared helper by exporting `resolveListenerLine` from `src/rules/listenerSymbols.js` and reusing it in `src/rules/listenerConfig.js` and `src/rules/crossFileSymbols.js`.
  - removed an unreachable branch in `src/cli/check.js` (`resolvedDirs.length === 0`), since `resolveDirs` always returns at least one directory.
  - ran the full scenario suite; all scenarios passed (`37/37`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - refactor `src/core/model.js` with shared file-loading helpers (`read + parse yaml` and `read + extract exports`) to reduce duplication while preserving current diagnostics and scenario output.

## Iteration 27 - 2026-02-13T12:29:09Z
- focus: Refactor for simplicity: delete dead branches and consolidate helpers.
- codex_exit: 0
- eval_exit: 0
- pass_count: 37
- notes: ok

### Last Codex Message (tail)
**What changed**
- Consolidated duplicated listener line-resolution logic into one helper:
  - Added `resolveListenerLine` in `packages/rettangoli-check/src/rules/listenerSymbols.js:32`.
  - Reused it from `packages/rettangoli-check/src/rules/listenerConfig.js:1`.
  - Reused it from `packages/rettangoli-check/src/rules/crossFileSymbols.js:1`.
- Deleted an unreachable branch in CLI check flow:
  - Removed the `resolvedDirs.length === 0` guard from `packages/rettangoli-check/src/cli/check.js` (now `resolveDirs` fallback is the only path, see `packages/rettangoli-check/src/cli/check.js:21`).
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:1806`.

**Why this improves reliability/simplicity**
- Listener diagnostic line selection is now implemented once, so listener rules cannot drift in behavior over time.
- The CLI path no longer carries an impossible error branch, which simplifies control flow and reduces maintenance noise.

**Scenario test result**
- Ran `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: `All scenarios passed: 37/37`.
### Eval Log (tail)
$ node ./test/run-scenarios.mjs
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option

All scenarios passed: 37/37

## Iteration 28 - 2026-02-13T12:30:34Z
- completed changes:
  - added scenario `38-listener-flow-mapping-line-fallback` under `test/scenarios/` to assert deterministic listener diagnostic line fallback when listener options are defined in YAML flow-mapping form.
  - covered both listener-config and cross-file-symbol paths in one scenario by asserting `RTGL-CHECK-LISTENER-002`, `RTGL-CHECK-SYMBOL-001`, and `RTGL-CHECK-SYMBOL-002` each report line `4` from the event key.
  - updated `test/README.md` scenario index from 35 to 38 and listed scenarios `36`-`38`.
  - ran the full scenario suite; all scenarios passed (`38/38`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a complementary listener scenario where one option is block-style and another is flow-style to further lock in `preferredKeys` line precedence versus event-line fallback.

## Iteration 28 - 2026-02-13T12:31:15Z
- focus: Add or improve scenario tests before changing checker logic.
- codex_exit: 0
- eval_exit: 0
- pass_count: 38
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new scenario test: `packages/rettangoli-check/test/scenarios/38-listener-flow-mapping-line-fallback/expected.json`.
- Added its inputs:
  - `packages/rettangoli-check/test/scenarios/38-listener-flow-mapping-line-fallback/src/components/card/card.schema.yaml`
  - `packages/rettangoli-check/test/scenarios/38-listener-flow-mapping-line-fallback/src/components/card/card.view.yaml`
- Updated scenario documentation count/list in `packages/rettangoli-check/test/README.md`.
- Appended iteration 28 journal entry in `packages/rettangoli-check/.codex-journal.md`.

**Why This Improves Reliability/Simplicity**
- The new scenario locks deterministic diagnostic line behavior when listener config uses YAML flow-mapping (`tap: { handler: ..., action: ... }`), where option-level line metadata is absent.
- It verifies consistent fallback line resolution across both listener config and cross-file symbol checks without changing checker logic.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: `All scenarios passed: 38/38`.
### Eval Log (tail)
PASS 01-valid-minimal :: valid minimal component
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback

All scenarios passed: 38/38

## Iteration 29 - 2026-02-13T12:33:15Z
- completed changes:
  - added scenario `39-cli-json-thrown-error-stdout` to verify deterministic JSON output for runtime CLI failures when `--format json` is set.
  - updated `src/cli/bin.js` catch-path logic so non-argument runtime errors emit a stable JSON payload to `stdout` (code `RTGL-CLI-001`) and keep exit code `1`.
  - updated `test/README.md` scenario index from 38 to 39 and listed the new scenario.
  - ran the full scenario suite; all scenarios passed (`39/39`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a CLI scenario for `--format` missing/invalid values in combination with `--help` to lock precedence and keep flag parsing behavior deterministic.

## Iteration 29 - 2026-02-13T12:33:51Z
- focus: Make CLI behavior predictable: flags, exits, and output format.
- codex_exit: 0
- eval_exit: 0
- pass_count: 39
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new CLI scenario test at `packages/rettangoli-check/test/scenarios/39-cli-json-thrown-error-stdout/expected.json:1` to lock behavior when `--format json` is used and runtime setup fails (missing component dir).
- Updated CLI error handling in `packages/rettangoli-check/src/cli/bin.js:90` and `packages/rettangoli-check/src/cli/bin.js:120`:
  - Introduced a deterministic JSON runtime-error payload (`RTGL-CLI-001`).
  - In JSON mode, non-argument errors now print to `stdout` (not `stderr`) and keep exit code `1`.
  - Argument parsing errors remain unchanged (text on `stderr` + usage).
- Updated scenario docs count/list in `packages/rettangoli-check/test/README.md:22`.
- Appended iteration 29 journal entry in `packages/rettangoli-check/.codex-journal.md:1959`.

**Why This Improves Reliability/Simplicity**
- JSON mode now has predictable channel/format behavior even for thrown runtime errors, so machine consumers can always parse `stdout` JSON when `--format json` is selected.
- Change is minimal and isolated to CLI catch-path behavior; existing success/error flows are preserved.

**Scenario Test Result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: `All scenarios passed: 39/39`.
### Eval Log (tail)
PASS 02-missing-schema :: missing schema file
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout

All scenarios passed: 39/39

## Iteration 30 - 2026-02-13T12:36:09Z
- completed changes:
  - added scenario `40-cli-json-dir-file-path-error` to lock CLI behavior when `--dir` points to an existing file instead of a directory.
  - hardened directory handling by introducing `isDirectoryPath` in `src/utils/fs.js` and using it to guard `walkFiles` roots.
  - updated `src/cli/check.js` directory validation to treat non-directory `--dir` paths as invalid, producing the same deterministic runtime error contract as missing directories.
  - updated `src/core/discovery.js` to resolve only real directories.
  - updated `test/README.md` scenario count/list from 39 to 40.
  - ran full scenario suite; all scenarios passed (`40/40`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - add a focused scenario for duplicate `--dir` inputs and optionally deduplicate resolved directories to reduce unnecessary filesystem traversal while preserving diagnostics.

## Iteration 30 - 2026-02-13T12:36:41Z
- focus: Prioritize maintainability: minimal code, maximal signal.
- codex_exit: 0
- eval_exit: 0
- pass_count: 40
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added scenario `40-cli-json-dir-file-path-error` to lock CLI behavior when `--dir` points to a file: `packages/rettangoli-check/test/scenarios/40-cli-json-dir-file-path-error/expected.json:1` (with fixture file `packages/rettangoli-check/test/scenarios/40-cli-json-dir-file-path-error/src/not-a-dir.txt`).
- Hardened directory checks by adding `isDirectoryPath` and guarding walker roots in `packages/rettangoli-check/src/utils/fs.js:4`.
- Updated discovery to only resolve real directories in `packages/rettangoli-check/src/core/discovery.js:24`.
- Updated CLI pre-validation to reject non-directory `--dir` paths in `packages/rettangoli-check/src/cli/check.js:46` (same deterministic error contract as missing dirs).
- Updated scenario docs count/list in `packages/rettangoli-check/test/README.md:22`.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md:2036`.

**Why this improves reliability/simplicity**
- Prevents `ENOTDIR` runtime leakage from filesystem traversal and replaces it with a stable, intentional validation path.
- Reuses a single directory predicate across CLI/discovery/walker code, reducing edge-case branching and making behavior easier to reason about.

**Scenario test result**
- Ran `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`.
- Result: `All scenarios passed: 40/40`.
### Eval Log (tail)
PASS 03-forbidden-view-key :: forbidden key in view
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir

All scenarios passed: 40/40

## Iteration 31 - 2026-02-13T12:38:43Z
- completed changes:
  - added scenario `41-yahtml-global-microdata-attrs` with YAHTML template coverage for global microdata attrs on custom elements (`itemscope`, `itemType`, `itemProp`, `itemId`, `itemRef`).
  - expanded `GENERIC_ALLOWED_ATTRS` in `src/rules/yahtmlAttrs.js` to include microdata globals: `itemid`, `itemprop`, `itemref`, `itemscope`, `itemtype`.
  - updated `test/README.md` scenario count/list from 40 to 41.
  - ran full scenario suite; all scenarios passed (`41/41`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - extend YAHTML generic attr coverage with a similarly constrained, standards-based addition (for example `autocorrect` or `virtualkeyboardpolicy`) only when backed by a failing-first scenario to keep false positives low.

## Iteration 31 - 2026-02-13T12:39:21Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 41
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a failing-first YAHTML scenario for microdata globals, then made it pass:
  - `packages/rettangoli-check/test/scenarios/41-yahtml-global-microdata-attrs/src/components/card/card.view.yaml:2`
  - `packages/rettangoli-check/test/scenarios/41-yahtml-global-microdata-attrs/expected.json:1`
- Expanded YAHTML generic allowlist with standard microdata attributes:
  - `packages/rettangoli-check/src/rules/yahtmlAttrs.js:21`
  - Added: `itemid`, `itemprop`, `itemref`, `itemscope`, `itemtype`
- Updated scenario index/docs:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry (iteration 31 with timestamp, changes, blockers, next step):
  - `packages/rettangoli-check/.codex-journal.md:2114`

**Why this improves reliability/simplicity**
- Improves YAHTML attr coverage for standards-based global attrs that were previously false positives.
- Keeps behavior deterministic and low-risk by only extending a static allowlist (no parser or rule-flow complexity added).
- Test-first change locks behavior with a dedicated scenario.

**Scenario test result**
- Ran: `node ./test/run-scenarios.mjs` in `packages/rettangoli-check`
- Result: `All scenarios passed: 41/41`
### Eval Log (tail)
PASS 04-legacy-dot-prop :: legacy dot prop binding
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs

All scenarios passed: 41/41

## Iteration 32 - 2026-02-13T12:42:54Z
- completed changes:
  - added failing-first scenario `42-cross-file-symbol-export-star` to cover cross-file handler/action/method symbol resolution through `export * from` re-exports.
  - implemented `collectExportStarSpecifiers` in `src/core/parsers.js` using masked-source position scanning so commented/string content is still ignored.
  - extended component export collection in `src/core/model.js` with deterministic local `export *` resolution for `.handlers.js`, `.store.js`, and `.methods.js` (recursive with cycle guard; excludes `default` from star re-exports).
  - updated `test/README.md` scenario count/list from 41 to 42.
  - ran full scenario suite; all scenarios passed (`42/42`).
- blockers encountered:
  - initial export-star regex approach failed because masking removes quote characters; switched to matching `export * from` in masked source and reading the literal from original source by index.
- next-step hypothesis:
  - add one more focused cross-file scenario for `export { symbol as alias } from "./impl.js"` mixed with local exports to further harden parser edge cases without broad resolver complexity.

## Iteration 32 - 2026-02-13T12:43:36Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 42
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added new scenario `42-cross-file-symbol-export-star` to lock expected behavior for re-exported handler/action/method symbols via `export * from ...`:
  - `packages/rettangoli-check/test/scenarios/42-cross-file-symbol-export-star/src/components/card/card.handlers.js:1`
  - `packages/rettangoli-check/test/scenarios/42-cross-file-symbol-export-star/src/components/card/card.store.js:1`
  - `packages/rettangoli-check/test/scenarios/42-cross-file-symbol-export-star/src/components/card/card.methods.js:1`
  - `packages/rettangoli-check/test/scenarios/42-cross-file-symbol-export-star/expected.json:1`
- Added `collectExportStarSpecifiers` so export-star declarations are detected while still ignoring commented/string content:
  - `packages/rettangoli-check/src/core/parsers.js:269`
- Updated component export collection to recursively resolve local `export *` chains for `.handlers.js`, `.store.js`, and `.methods.js`, with cycle guard and no `default` propagation:
  - `packages/rettangoli-check/src/core/model.js:42`
  - `packages/rettangoli-check/src/core/model.js:77`
  - `packages/rettangoli-check/src/core/model.js:220`
- Updated scenario docs count/list:
  - `packages/rettangoli-check/test/README.md:22`
- Appended iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:2195`

**Why This Improves Reliability/Simplicity**
- Prevents false missing-symbol errors when teams structure handlers/actions/methods through local `export *` re-export files.
- Keeps behavior deterministic and constrained by supporting only local relative re-exports with simple extension resolution and cycle protection.
- Strengthens coverage with a focused scenario test before logic change.

**Scenario Test Result**
- Ran: `cd packages/rettangoli-check && node ./test/run-scenarios.mjs`
- Result: `All scenarios passed: 42/42`
### Eval Log (tail)
PASS 05-missing-handler-export :: missing handler export
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star

All scenarios passed: 42/42

## Iteration 33 - 2026-02-13T12:47:04Z
- completed changes:
  - added failing-first scenario `43-selector-explicit-key-list` to cover YAML explicit-key list entries for template selector lines (`- ? 'selector attrs'` followed by `: value`).
  - updated selector list-line parsing in `src/core/parsers.js` by:
    - adding `stripYamlTrailingComment` to safely remove trailing YAML comments outside quotes.
    - extending `splitYamlListLineKey` to extract explicit keys from `- ? ...` list entries before standard `key: value` scanning.
  - updated scenario docs count/list in `test/README.md` from 42 to 43.
  - ran full scenario suite; all scenarios passed (`43/43`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - harden selector extraction for additional uncommon but valid YAML forms (for example explicit-key lines with anchors/tags) while keeping parser behavior deterministic and line-accurate.

## Iteration 33 - 2026-02-13T12:47:57Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 0
- eval_exit: 0
- pass_count: 43
- notes: ok

### Last Codex Message (tail)
**What changed**
1. Added a failing-first scenario for explicit-key YAML selector lines:
`packages/rettangoli-check/test/scenarios/43-selector-explicit-key-list/src/components/card/card.view.yaml:1`
`packages/rettangoli-check/test/scenarios/43-selector-explicit-key-list/src/components/card/card.schema.yaml:1`
`packages/rettangoli-check/test/scenarios/43-selector-explicit-key-list/expected.json:1`

2. Hardened list-line selector parsing to support `- ? ...` explicit-key entries:
`packages/rettangoli-check/src/core/parsers.js:340`
`packages/rettangoli-check/src/core/parsers.js:377`

3. Updated scenario index docs:
`packages/rettangoli-check/test/README.md:22`

4. Appended iteration journal entry (iteration 33, timestamp, changes, blockers, next-step hypothesis):
`packages/rettangoli-check/.codex-journal.md:2282`

**Why this improves reliability/simplicity**
- Fixes a real parser blind spot for valid YAML explicit-key list mappings, preventing missed selector attr checks.
- Keeps behavior deterministic with a narrow parser change and dedicated scenario coverage.
- Change is minimal and localized to selector line extraction.

**Scenario test result**
- Ran: `cd packages/rettangoli-check && node ./test/run-scenarios.mjs`
- Result: `All scenarios passed: 43/43`
### Eval Log (tail)
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping

All scenarios passed: 43/43

## Iteration 34 - 2026-02-13T12:50:53Z
- completed changes:
  - tightened scenario expectations to require line-precise diagnostics for:
    - `07-schema-method-missing-export` (`RTGL-CHECK-SYMBOL-003` now asserted with `line: 5`)
    - `10-duplicate-component-name` (`RTGL-CHECK-SCHEMA-008` now asserted with per-file `line: 1`)
    - `15-schema-component-name-whitespace` (`RTGL-CHECK-SCHEMA-003` now asserted with `line: 1`)
  - added schema YAML key-path line tracking to component model construction:
    - `src/core/model.js` now stores `schema.yamlKeyPathLines` using `collectYamlKeyPathLines(...)`.
  - improved schema-rule diagnostics line precision:
    - `RTGL-CHECK-SCHEMA-002/003/004/005/006/007/008` now attach schema key-path-based `line` when available.
    - duplicate `componentName` ownership now retains `{ filePath, line }` for deterministic duplicate diagnostics.
  - improved cross-file symbol diagnostics line precision:
    - `RTGL-CHECK-SYMBOL-003` now points to `schema.methods.properties.<methodName>` line.
  - ran full scenario suite; all scenarios passed (`43/43`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - extend file:line precision to remaining schema-adjacent diagnostics without line metadata (for example constants root-shape errors) via conservative fallback rules that avoid inaccurate line guesses.

## Iteration 34 - 2026-02-13T12:51:43Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 0
- eval_exit: 0
- pass_count: 43
- notes: ok

### Last Codex Message (tail)
**What changed**
1. Added schema YAML key-path line tracking in the model so schema diagnostics can resolve precise source lines: `packages/rettangoli-check/src/core/model.js:137`, `packages/rettangoli-check/src/core/model.js:198`.
2. Tightened schema diagnostics to include line metadata (when available) for stable existing codes `RTGL-CHECK-SCHEMA-002` through `RTGL-CHECK-SCHEMA-008`: `packages/rettangoli-check/src/rules/schema.js:1`, `packages/rettangoli-check/src/rules/schema.js:46`, `packages/rettangoli-check/src/rules/schema.js:120`.
3. Added line precision for cross-file missing schema method export (`RTGL-CHECK-SYMBOL-003`) using `methods.properties.<methodName>` key path: `packages/rettangoli-check/src/rules/crossFileSymbols.js:3`, `packages/rettangoli-check/src/rules/crossFileSymbols.js:75`.
4. Updated scenarios to assert line-precise diagnostics:
- `packages/rettangoli-check/test/scenarios/07-schema-method-missing-export/expected.json:15`
- `packages/rettangoli-check/test/scenarios/10-duplicate-component-name/expected.json:15`
- `packages/rettangoli-check/test/scenarios/15-schema-component-name-whitespace/expected.json:15`
5. Appended iteration 34 journal entry: `packages/rettangoli-check/.codex-journal.md:2369`.

**Why this improves reliability/simplicity**
- Keeps diagnostic codes/messages stable while improving `file:line` precision deterministically from parsed YAML key paths (no heuristic guessing).
- Improves debuggability for schema and schema/method parity failures with minimal localized changes.
- Locks behavior via stricter scenario assertions on exact diagnostics.

**Scenario test result**
- Ran: `cd packages/rettangoli-check && node ./test/run-scenarios.mjs`
- Result: `All scenarios passed: 43/43`
### Eval Log (tail)
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping

All scenarios passed: 43/43

## Iteration 35 - 2026-02-13T12:54:14Z
- completed changes:
  - strengthened registry coverage in scenario `36-project-schema-registry-augments-ui-tag` by adding a project-prop binding assertion in `src/components/host/host.view.yaml` (`:accentColor`) while keeping expected outcome unchanged.
  - reduced schema-registry generation complexity in `src/core/registry.js` by introducing shared helpers:
    - added `hasNonEmptyComponentName` and `hasNonBlankComponentName` validators.
    - added `buildSchemaRegistry({ schemas, source, isValidComponentName })` and reused it for both UI schema contracts and project schema contracts.
    - simplified `extractUiComponentContracts` to collect parsed schemas first, then build via the shared helper.
    - simplified `buildProjectSchemaRegistry` to map model schemas and delegate to the shared helper.
  - ran full scenario suite; all scenarios passed (`43/43`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - continue splitting `src/core/registry.js` into narrowly scoped pure helpers (especially primitive extraction/parsing) and add focused scenarios around primitive attr harvesting to keep refactors deterministic.

## Iteration 35 - 2026-02-13T12:54:46Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 0
- eval_exit: 0
- pass_count: 43
- notes: ok

### Last Codex Message (tail)
**What changed**
1. Strengthened registry scenario coverage by asserting project-schema prop binding on a UI tag in `packages/rettangoli-check/test/scenarios/36-project-schema-registry-augments-ui-tag/src/components/host/host.view.yaml:2` (`:accentColor=blue`).
2. Reduced registry-generation complexity by centralizing schema-contract map creation in `packages/rettangoli-check/src/core/registry.js:88` (`buildSchemaRegistry`), and reusing it from:
   - UI schema extraction: `packages/rettangoli-check/src/core/registry.js:122`
   - Project schema registry build: `packages/rettangoli-check/src/core/registry.js:411`
3. Made validator intent explicit with named helpers in `packages/rettangoli-check/src/core/registry.js:47` and `packages/rettangoli-check/src/core/registry.js:51`.
4. Appended iteration journal entry at `packages/rettangoli-check/.codex-journal.md:2456`.

**Why this improves reliability/simplicity**
- Removes duplicated schema-registry wiring and keeps both paths on one deterministic build flow.
- Keeps previous behavior intact by preserving separate validation rules (non-empty vs non-blank component names) while making that distinction explicit.
- Adds scenario coverage for prop-style acceptance from project schema on augmented UI tags, guarding against regression during future refactors.

**Scenario test result**
- Ran: `cd packages/rettangoli-check && node ./test/run-scenarios.mjs`
- Result: `All scenarios passed: 43/43`
### Eval Log (tail)
PASS 06-missing-action-export :: missing store action export
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping

All scenarios passed: 43/43

## Iteration 36 - 2026-02-13T12:57:29Z
- completed changes:
  - added scenario `44-listener-nonobject-event-listeners` to cover invalid `refs.*.eventListeners` container shape and assert deterministic line reporting.
  - strengthened listener contract checks in `src/rules/listenerConfig.js` by validating `refs.<ref>.eventListeners` is an object map when present; now emits `RTGL-CHECK-LISTENER-009` when malformed.
  - ran full scenario suite; all scenarios passed (`44/44`).
- blockers encountered:
  - none.
- next-step hypothesis:
  - extend listener contract coverage for malformed `refs.<ref>` container types (non-object ref config) with scenario-first checks to prevent silent skips in nested listener validation.

## Iteration 36 - 2026-02-13T12:58:06Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 0
- eval_exit: 0
- pass_count: 44
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new scenario: `packages/rettangoli-check/test/scenarios/44-listener-nonobject-event-listeners/expected.json` (with matching `card.view.yaml` and `card.schema.yaml`) to assert that non-object `refs.<ref>.eventListeners` is rejected with a deterministic line (`line: 3`).
- Updated listener contract validation in `packages/rettangoli-check/src/rules/listenerConfig.js:3` and `packages/rettangoli-check/src/rules/listenerConfig.js:75` to explicitly validate `refs.<ref>.eventListeners` shape and emit:
  - `RTGL-CHECK-LISTENER-009`
  - message: `invalid eventListeners config on ref '<refKey>'. Expected an object keyed by event type.`
- Appended the iteration journal entry at `packages/rettangoli-check/.codex-journal.md:2536`.

**Why This Improves Reliability/Simplicity**
- Previously, malformed `eventListeners` containers were silently skipped by listener extraction. Now they produce a deterministic contract error.
- The change is small and localized to listener validation, with scenario-first coverage to prevent regressions.

**Scenario Test Result**
- Ran: `cd packages/rettangoli-check && node ./test/run-scenarios.mjs`
- Result: `All scenarios passed: 44/44`
### Eval Log (tail)
PASS 07-schema-method-missing-export :: schema method missing export
PASS 08-listener-both-handler-action :: listener both handler and action
PASS 09-yahtml-unknown-attr :: yahtml unknown attr
PASS 10-duplicate-component-name :: duplicate componentName
PASS 11-yahtml-global-attrs :: yahtml global attrs on custom elements
PASS 12-commented-exports-ignored :: commented exports are ignored for symbols
PASS 13-quoted-selector-escaped-quotes :: quoted selector line with escaped quotes
PASS 14-listener-invalid-symbol :: listener invalid symbol
PASS 15-schema-component-name-whitespace :: schema componentName with surrounding whitespace
PASS 16-listener-nonobject-config :: listener non-object event config
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config

All scenarios passed: 44/44

## Iteration 37 - 2026-02-13T21:53:40Z
- completed changes:
  - added `src/rules/jempl.js` and wired it into the rule pipeline to validate Jempl syntax in `view.template` and listener `payload` blocks.
  - introduced diagnostics:
    - `RTGL-CHECK-JEMPL-001` for invalid template Jempl.
    - `RTGL-CHECK-JEMPL-002` for invalid listener payload Jempl.
  - updated listener option allowlist to include `payload` so runtime-valid listeners do not get false-positive `RTGL-CHECK-LISTENER-008`.
  - added scenario `49-jempl-template-parse-error` and `50-jempl-listener-payload-parse-error` with exact diagnostic assertions.
  - removed temporary probe file used to verify jempl parser behavior.
  - updated scenario docs count to `50`.
  - ran tests:
    - `bun run --cwd packages/rettangoli-check test:scenarios` -> `50/50` passed.
    - `bun run --cwd packages/rettangoli-fe test` -> `137/137` passed.
- blockers encountered:
  - initial payload scenario also triggered unknown-listener-option error because `payload` was missing from the checker allowlist.
- next-step hypothesis:
  - expand Jempl checks from parse validity to semantic validation against schema symbols/constants and support line/column ranges once YAHTML AST work starts.

## Iteration 38 - 2026-02-13T22:49:20Z
- completed changes:
  - integrated `yahtml@0.0.5` in checker and started AST-first selector extraction path.
  - in `src/core/parsers.js`, added `collectSelectorBindingsFromView` that tries `parseYahtmlAst(template)` to collect element bindings, with safe fallback to line-heuristic parsing when AST parsing fails.
  - retained current FE binding-name parsing logic (`collectFeBindingNames`) to preserve `:prop`, `?bool`, and legacy detection behavior.
  - in `src/core/model.js`, switched selector binding assembly to use the new AST-first collector after YAML parse, while preserving heuristic pre-parse fallback for parse-error paths.
  - added scenario `51-yahtml-ast-fallback-control-flow` to lock control-flow fallback behavior when template contains `$if` keys that YAHTML AST parser does not currently model.
  - updated scenario README count to `51`.
  - ran tests:
    - `bun run --cwd packages/rettangoli-check test:scenarios` -> `51/51` passed.
    - `bun run --cwd packages/rettangoli-fe test` -> `137/137` passed.
- blockers encountered:
  - YAHTML AST parser currently rejects Jempl control keys (`$if`, `$for`, ...), so full AST-only path would regress these templates.
- next-step hypothesis:
  - extend YAHTML AST path with control-directive-aware traversal (or lightweight pre-transform) so selector extraction no longer needs fallback on control-flow templates.

## Iteration 39 - 2026-02-13T15:07:06Z
- completed changes:
  - fixed YAHTML AST selector extraction in `src/core/parsers.js` to stop treating every object key as a selector.
  - added context-aware traversal that:
    - keeps control-flow branches as template nodes,
    - extracts object-notation element attrs (excluding `children`) into `bindingNames`,
    - continues traversing nested template content from `children`.
  - added scenario `53-yahtml-object-notation-global-attrs` to assert object-notation `aria-*` and `data-*` attrs do not trigger false positives.
  - added scenario `54-yahtml-object-notation-unknown-attr` to assert unsupported attrs in object notation are now checked and reported as `RTGL-CHECK-YAHTML-003`.
  - updated scenario docs count to `54` in `test/README.md`.
  - ran tests:
    - `bun run --cwd packages/rettangoli-check test:scenarios` -> `54/54` passed.
- blockers encountered:
  - none.
- next-step hypothesis:
  - tighten YAHTML attr validation for additional object-notation edge cases (`children` variants and control directives nested in attr objects) while preserving deterministic line mapping.

## Iteration 1 - 2026-02-13T15:07:45Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 54
- notes: ok

### Last Codex Message (tail)
**What changed**
- Updated YAHTML AST traversal to separate selector keys from object-notation attrs in `packages/rettangoli-check/src/core/parsers.js:714`.
- Added object-notation attr extraction (`children` excluded) and merged those attrs into selector `bindingNames` in `packages/rettangoli-check/src/core/parsers.js:853`.
- Added scenario `53-yahtml-object-notation-global-attrs` to prevent false positives for valid object-notation attrs:
  - `packages/rettangoli-check/test/scenarios/53-yahtml-object-notation-global-attrs/expected.json`
- Added scenario `54-yahtml-object-notation-unknown-attr` to ensure unsupported object-notation attrs are now checked:
  - `packages/rettangoli-check/test/scenarios/54-yahtml-object-notation-unknown-attr/expected.json`
- Updated scenario docs count/list in `packages/rettangoli-check/test/README.md`.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md`.

**Why this improves reliability/simplicity**
- Fixes a real false-positive source: object-notation attr keys like `data-test-id` were previously misread as custom elements.
- Improves attr coverage: object-notation attrs are now validated like inline attrs, so unsupported attrs (for example `banana`) are caught deterministically.
- Keeps logic localized to parser traversal with scenario-first coverage and no broad rule rewrites.

**Scenario test result**
- Ran: `bun run --cwd packages/rettangoli-check test:scenarios`
- Result: `All scenarios passed: 54/54`
### Eval Log (tail)
PASS 17-constants-nonobject-root :: constants yaml requires object root
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr

All scenarios passed: 54/54

## Iteration 2 - 2026-02-13T15:11:08Z
- completed changes:
  - added scenario `55-cross-file-symbol-export-star-typescript-target` covering cross-file symbol resolution for handler/action/method when `.handlers.js`/`.store.js`/`.methods.js` use extensionless `export *` to `.ts` implementation files.
  - updated export target resolution in `src/core/model.js` to probe JS/TS script candidates (`.js/.mjs/.cjs/.ts/.mts/.cts` + `index.*`) when specifier has no known script extension.
  - fixed dotted-extension edge case (`./card.handlers.impl`) by treating unknown suffixes as unresolved and still probing script extensions, preventing false missing-symbol diagnostics.
  - updated scenario docs count/list in `test/README.md` to `55`.
  - ran scenarios: `bun run --cwd packages/rettangoli-check test:scenarios` -> `All scenarios passed: 55/55`.
- blockers encountered:
  - initial resolver patch did not fix the scenario because `path.extname("./card.handlers.impl")` returns `.impl`, which bypassed extension probing; required an additional known-extension gate.
- next-step hypothesis:
  - add one focused scenario for chained mixed re-exports (`export { ... } from` + `export *`) across two hops to further harden deterministic cross-file symbol collection without widening rule scope.

## Iteration 2 - 2026-02-13T15:11:48Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 55
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added new scenario `55-cross-file-symbol-export-star-typescript-target` under `packages/rettangoli-check/test/scenarios/55-cross-file-symbol-export-star-typescript-target` to cover cross-file handler/action/method symbols re-exported via extensionless `export *` into `.ts` files.
- Updated export target resolution in `packages/rettangoli-check/src/core/model.js:42`:
  - probes JS/TS candidates (`.js/.mjs/.cjs/.ts/.mts/.cts` and `index.*`) for extensionless/unknown-extension specifiers.
  - fixes dotted specifier case like `./card.handlers.impl` (previously treated as fully explicit due `.impl`).
- Updated scenario docs in `packages/rettangoli-check/test/README.md:22` to 55 scenarios.
- Appended iteration journal entry in `packages/rettangoli-check/.codex-journal.md:2729`.

**Why this improves reliability/simplicity**
- Prevents false missing-symbol errors for handlers/actions/methods when components use common re-export patterns from TypeScript implementation files.
- Keeps behavior deterministic with a localized resolver change and scenario-first coverage (no rule-surface expansion).

**Scenario test result**
- Ran `bun run --cwd packages/rettangoli-check test:scenarios`.
- Result: `All scenarios passed: 55/55`.
### Eval Log (tail)
PASS 18-cli-unknown-flag :: cli rejects unknown option
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target

All scenarios passed: 55/55

## Iteration 1 - 2026-02-13T15:50:45Z
- completed changes:
  - added scenario `56-yahtml-event-binding-attr-coverage` to cover YAHTML `@event` bindings on custom elements without raising unsupported attr diagnostics.
  - updated YAHTML attr rule in `src/rules/yahtmlAttrs.js` to classify `@...` tokens as event bindings and skip attr/prop validation for that token type.
  - updated scenario docs in `test/README.md` to 56 scenarios.
  - ran scenarios: `bun run --cwd packages/rettangoli-check test:scenarios` -> `All scenarios passed: 56/56`.
- blockers encountered:
  - none.
- next-step hypothesis:
  - add one targeted scenario for object-notation YAHTML event bindings (e.g. `@click` key in object form) to confirm the same event-token skip path remains deterministic across parser modes.

## Iteration 1 - 2026-02-13T15:51:19Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 56
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added a new scenario for YAHTML event bindings:
  - `packages/rettangoli-check/test/scenarios/56-yahtml-event-binding-attr-coverage/src/components/card/card.view.yaml:2`
  - `packages/rettangoli-check/test/scenarios/56-yahtml-event-binding-attr-coverage/expected.json:1`
- Updated YAHTML attr normalization/checking to treat `@...` as event bindings and skip attr/prop validation for those tokens:
  - `packages/rettangoli-check/src/rules/yahtmlAttrs.js:39`
  - `packages/rettangoli-check/src/rules/yahtmlAttrs.js:163`
- Updated scenario docs count/list to 56:
  - `packages/rettangoli-check/test/README.md:22`
- Appended the iteration journal entry:
  - `packages/rettangoli-check/.codex-journal.md:2806`

**Why this improves reliability/simplicity**
- Removes a real false positive (`@click` previously reported as unsupported attr) while keeping validation strict for actual attrs/props.
- Change is localized and deterministic: one new token type (`event`) in existing normalization flow, no broader rule expansion.

**Scenario test result**
- Ran: `bun run --cwd packages/rettangoli-check test:scenarios`
- Result: `All scenarios passed: 56/56`
### Eval Log (tail)
PASS 19-cli-text-error-stderr :: cli prints text report to stderr on error
PASS 20-cli-json-success :: cli emits json report on stdout
PASS 21-warn-only-method-undocumented :: warn-only undocumented method export
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage

All scenarios passed: 56/56

## Iteration 2 - 2026-02-13T15:54:32Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 3 - 2026-02-13T15:54:33Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 4 - 2026-02-13T15:54:35Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 5 - 2026-02-13T15:54:39Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 6 - 2026-02-13T15:54:40Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 7 - 2026-02-13T15:54:41Z
- focus: Refactor for simplicity: delete dead branches and consolidate helpers.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 8 - 2026-02-13T15:54:43Z
- focus: Add or improve scenario tests before changing checker logic.
- codex_exit: 1
- eval_exit: 1
- pass_count: 56
- notes: codex_failed

### Last Codex Message (tail)
(no captured last message)

### Eval Log (tail)
  "warnCount": 0,
  "errorCodes": {
    "RTGL-CHECK-SYMBOL-001": 1,
    "RTGL-CHECK-SYMBOL-002": 1,
    "RTGL-CHECK-SYMBOL-003": 1
  },
  "warnCodes": {},
  "diagnostics": [
    {
      "code": "RTGL-CHECK-SYMBOL-001",
      "severity": "error",
      "message": "components/card: handler 'handleTap' for event 'tap' on ref 'root' is missing in .handlers.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 5
    },
    {
      "code": "RTGL-CHECK-SYMBOL-002",
      "severity": "error",
      "message": "components/card: action 'setCount' for event 'click' on ref 'root' is missing in .store.js exports.",
      "filePath": "src/components/card/card.view.yaml",
      "line": 7
    },
    {
      "code": "RTGL-CHECK-SYMBOL-003",
      "severity": "error",
      "message": "components/card: method 'focusInput' is declared in schema but missing in .methods.js exports.",
      "filePath": "src/components/card/card.schema.yaml",
      "line": 5
    }
  ]
}
Actual: {
  "ok": true,
  "errorCount": 0,
  "warnCount": 0,
  "errorCodes": {},
  "warnCodes": {},
  "diagnostics": []
}
error: script "test:scenarios" exited with code 1

## Iteration 1 - 2026-02-13T16:46:53Z
- completed changes:
  - Added scenario `58-yahtml-bare-legacy-prop-token` to cover bare legacy token parsing in YAHTML checks.
  - Added scenario `59-yahtml-bare-event-token-no-false-positive` to ensure bare `@event` tokens are not misclassified as attrs.
  - Updated `parseBindingNames` fallback logic in `src/core/parsers.js`:
    - fallback to local tokenizer when FE shared parser returns empty names but local names exist.
    - fallback to local tokenizer when FE shared output drops a leading binding prefix (`@`, `:`, `?`, `.`).
  - Updated expected diagnostics for scenario 58 to reflect FE parity + YAHTML legacy detection.
- blockers encountered:
  - No external blockers; one internal expectation mismatch was resolved by updating scenario 58 expected output after parser behavior aligned with FE parity diagnostics.
- next-step hypothesis:
  - Expand YAHTML coverage for object-notation prefixed bindings (`"@click"`, `":prop"`, `"?flag"`) to ensure prefix preservation is consistent across AST/object paths.

## Iteration 1 - 2026-02-13T16:47:49Z
- focus: Improve YAHTML attr coverage while keeping false positives low.
- codex_exit: 0
- eval_exit: 0
- pass_count: 59
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Updated YAHTML binding-name parsing fallback in `packages/rettangoli-check/src/core/parsers.js:1076`:
  - Use local tokenization when FE shared parser returns no names but local parsing found names.
  - Use local tokenization when FE shared names drop a leading binding prefix (`@`, `:`, `?`, `.`), preserving binding semantics deterministically.
- Added scenario `packages/rettangoli-check/test/scenarios/58-yahtml-bare-legacy-prop-token/expected.json:1` (and fixtures) to cover bare legacy token handling.
- Added scenario `packages/rettangoli-check/test/scenarios/59-yahtml-bare-event-token-no-false-positive/expected.json:1` (and fixtures) to prevent bare event token misclassification false positives.
- Appended iteration journal entry at `packages/rettangoli-check/.codex-journal.md:3250`.

**Why It Improves Reliability/Simplicity**
- Reliability: prefix-preserving fallback removes a parser edge case where `@/:/?/.` prefixes were lost, which could misclassify bindings and produce wrong YAHTML diagnostics.
- Simplicity: the fallback logic is narrow and local to `parseBindingNames`, with no broader rule changes.
- Determinism: behavior is now locked with scenario tests for both legacy-token detection and event-token false-positive prevention.

**Scenario Test Result**
- Ran full suite: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 59/59`
### Eval Log (tail)
PASS 22-cli-warn-as-error :: cli warn-as-error fails warning-only project
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive

All scenarios passed: 59/59

## Iteration 2 - 2026-02-13T16:50:09Z
- completed changes:
  - Added scenario `60-cross-file-symbol-explicit-js-specifier-typescript-target` covering cross-file handler/action/method symbol resolution when re-export specifiers use explicit `.js` while implementation files are `.ts`.
  - Updated `src/core/model.js` (`resolveLocalExportTarget`) to try deterministic sibling script-extension fallbacks for explicit script specifiers (e.g. `.js` -> `.ts/.mts/.cts`) when the exact file is missing.
  - Verified focused cross-file scenarios (`42`, `55`, `57`, `60`) and full suite.
- blockers encountered:
  - No external blockers.
- next-step hypothesis:
  - Add coverage for explicit-extension named re-exports (`export { foo } from "./impl.js"` with `.ts` targets) to ensure parity with `export *` fallback behavior across handlers/actions/methods.

## Iteration 2 - 2026-02-13T16:50:38Z
- focus: Strengthen cross-file symbol checks for handlers/actions/methods.
- codex_exit: 0
- eval_exit: 0
- pass_count: 60
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added scenario `packages/rettangoli-check/test/scenarios/60-cross-file-symbol-explicit-js-specifier-typescript-target/expected.json:1` (with fixtures) to cover cross-file symbol resolution when `.handlers.js` / `.store.js` / `.methods.js` use explicit `.js` re-export specifiers but the target files are `.ts`.
- Updated export-target resolution in `packages/rettangoli-check/src/core/model.js:42` to keep deterministic extension fallback for explicit script specifiers (for example, `.js` can fall back to `.ts/.mts/.cts` if the exact file is missing).
- Appended iteration log in `packages/rettangoli-check/.codex-journal.md:3329`.

**Why this improves reliability/simplicity**
- Reliability: fixes a real false-negative path for handlers/actions/method checks in TS projects using ESM-style `.js` specifiers.
- Simplicity: change is localized to one resolver function with deterministic fallback order; no rule-surface expansion.

**Scenario test result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 60/60`
### Eval Log (tail)
PASS 23-yahtml-generic-camelcase-attrs :: yahtml generic attrs support camelCase variants
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target

All scenarios passed: 60/60

## Iteration 3 - 2026-02-13T16:53:53Z
- completed changes:
  - Added scenario `61-selector-explicit-key-multiline` with fixtures to cover YAML multiline explicit-key selector entries (`- ?` followed by selector on the next line).
  - Updated `src/core/parsers.js` list-line parsing to track pending multiline explicit keys and resolve the selector from the subsequent key line in both candidate collection paths (`collectTemplateSelectorLineCandidates` and `collectSelectorBindingsFromViewText`).
  - Preserved existing inline explicit-key behavior (`- ? selector`) and verified compatibility with existing explicit-key scenario `43-selector-explicit-key-list`.
  - Ran full scenario suite successfully.
- blockers encountered:
  - No external blockers.
- next-step hypothesis:
  - Add coverage for multiline explicit-key selector lines with escaped quotes and inline comments to lock in deterministic line attribution across more YAML scalar variants.

## Iteration 3 - 2026-02-13T16:54:22Z
- focus: Improve parser correctness for tricky YAML list/selector lines.
- codex_exit: 0
- eval_exit: 0
- pass_count: 61
- notes: ok

### Last Codex Message (tail)
Implemented iteration 3 with a minimal parser fix and failing-first coverage.

**What changed**
1. Added scenario `61-selector-explicit-key-multiline`:
- `packages/rettangoli-check/test/scenarios/61-selector-explicit-key-multiline/src/components/card/card.view.yaml:1`
- `packages/rettangoli-check/test/scenarios/61-selector-explicit-key-multiline/src/components/card/card.schema.yaml:1`
- `packages/rettangoli-check/test/scenarios/61-selector-explicit-key-multiline/expected.json:1`

2. Updated YAML selector line parsing in `packages/rettangoli-check/src/core/parsers.js:602`:
- `splitYamlListLineKey` now distinguishes normal list keys vs pending multiline explicit keys (`- ?`).
- Added multiline explicit-key extractor (`splitYamlMultilineExplicitKey`).
- Both selector extraction paths now handle pending multiline explicit keys deterministically:
  - `collectTemplateSelectorLineCandidates` (`packages/rettangoli-check/src/core/parsers.js:778`)
  - `collectSelectorBindingsFromViewText` (`packages/rettangoli-check/src/core/parsers.js:1201`)

3. Appended iteration journal entry to:
- `packages/rettangoli-check/.codex-journal.md`

**Why this improves reliability/simplicity**
- Reliability: valid YAML explicit-key multiline selectors now get correct selector-line attribution (line 3 in the new scenario) instead of missing line info.
- Simplicity: fix is localized to parser line extraction with a small explicit state flag; no rule-surface expansion.

**Scenario test result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 61/61`
### Eval Log (tail)
PASS 24-method-default-export-direct :: method direct default export
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target
PASS 61-selector-explicit-key-multiline :: selector explicit-key multiline list mapping

All scenarios passed: 61/61

## Iteration 4 - 2026-02-13T16:57:02Z
- completed changes:
  - Added scenario `62-missing-schema-prefers-view-file` to reproduce and lock location precision for `RTGL-CONTRACT-001` when `.schema.yaml` is missing and multiple component files exist.
  - Updated `packages/rettangoli-check/src/rules/feParity.js` so `RTGL-CONTRACT-001` now prefers `model.view.filePath` before fallback paths.
  - Ran the full scenario suite after the fix.
- blockers encountered:
  - No blockers.
- next-step hypothesis:
  - Add a focused diagnostics-ordering check (filePath/line stable ordering) for multi-diagnostic components to further tighten deterministic output quality.

## Iteration 4 - 2026-02-13T16:57:32Z
- focus: Tighten diagnostics quality: stable codes, clear messages, file:line precision.
- codex_exit: 0
- eval_exit: 0
- pass_count: 62
- notes: ok

### Last Codex Message (tail)
**What Changed**
1. Added scenario coverage for diagnostic file-path precision:
- `packages/rettangoli-check/test/scenarios/62-missing-schema-prefers-view-file/expected.json:1`
- `packages/rettangoli-check/test/scenarios/62-missing-schema-prefers-view-file/src/components/card/card.view.yaml:1`
- `packages/rettangoli-check/test/scenarios/62-missing-schema-prefers-view-file/src/components/card/card.handlers.js:1`

2. Fixed missing-schema diagnostic location selection:
- `packages/rettangoli-check/src/rules/feParity.js:18`
- `RTGL-CONTRACT-001` now prefers `model.view.filePath` before fallback paths.

3. Appended iteration journal entry:
- `packages/rettangoli-check/.codex-journal.md:3487`

**Why This Improves Reliability/Simplicity**
- Reliability: `RTGL-CONTRACT-001` file attribution is now deterministic and points to `.view.yaml` even when other component files exist.
- Simplicity: one-line rule fix, plus one focused scenario; no broader behavior changes.

**Scenario Test Result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 62/62`
### Eval Log (tail)
PASS 25-list-lines-outside-template :: list mapping lines outside template are ignored
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target
PASS 61-selector-explicit-key-multiline :: selector explicit-key multiline list mapping
PASS 62-missing-schema-prefers-view-file :: missing schema prefers view file location

All scenarios passed: 62/62

## Iteration 5 - 2026-02-13T17:00:02Z
- completed changes:
  - Added scenario `63-project-schema-registry-duplicate-component-merges-props` to lock behavior that duplicate project schemas still contribute merged contract props to YAHTML validation (while duplicate-name diagnostics remain).
  - Simplified schema-registry generation in `packages/rettangoli-check/src/core/registry.js` by removing the `addSchemaContractToRegistry` indirection and folding its logic into `buildSchemaRegistry`.
  - Simplified `mergeRegistryMaps` to a reduce-based merge while preserving merge order and contract union behavior.
  - Ran the full scenario suite after changes.
- blockers encountered:
  - No blockers.
- next-step hypothesis:
  - Reduce parsing complexity in primitive/global-style registry extraction by splitting regex scanners into small pure helpers with direct scenario coverage for each extraction path.

## Iteration 5 - 2026-02-13T17:00:36Z
- focus: Reduce complexity in registry generation while preserving behavior.
- codex_exit: 0
- eval_exit: 0
- pass_count: 63
- notes: ok

### Last Codex Message (tail)
**What Changed**
- Added a new scenario to lock duplicate-schema registry behavior: `packages/rettangoli-check/test/scenarios/63-project-schema-registry-duplicate-component-merges-props/expected.json:1` (with fixtures under the same scenario directory).
- Simplified schema registry generation by removing one helper layer and keeping contract creation/prop merge in a single pass: `packages/rettangoli-check/src/core/registry.js:72`.
- Simplified registry map merging to a single reduce flow (same merge semantics/order): `packages/rettangoli-check/src/core/registry.js:99`.
- Appended iteration 5 journal entry: `packages/rettangoli-check/.codex-journal.md:3567`.

**Why This Improves Reliability/Simplicity**
- Reliability: scenario `63` ensures duplicate `componentName` schemas still produce merged props for YAHTML validation, preventing regressions in contract availability during duplicate-name errors.
- Simplicity: registry generation now has fewer moving parts (`buildSchemaRegistry` does the full per-schema update), making behavior easier to reason about and less error-prone.

**Scenario Test Result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 63/63`
### Eval Log (tail)
PASS 26-schema-parse-error-line :: schema yaml parse error includes line
PASS 27-project-schema-registry-cross-component :: project schema registry cross component
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target
PASS 61-selector-explicit-key-multiline :: selector explicit-key multiline list mapping
PASS 62-missing-schema-prefers-view-file :: missing schema prefers view file location
PASS 63-project-schema-registry-duplicate-component-merges-props :: project schema registry duplicate component merges props

All scenarios passed: 63/63

## Iteration 6 - 2026-02-13T17:06:05Z
- completed changes:
  - Added scenario `64-project-schema-registry-trims-component-name-whitespace` to lock that project schema registry uses trimmed `componentName` for contract matching, preventing YAHTML unknown-element cascades from surrounding whitespace.
  - Added scenario `65-listener-invalid-ref-key-short-circuits-listener-contract` to lock that invalid ref keys (`RTGL-CHECK-REF-001`) short-circuit downstream listener/symbol diagnostics for the same ref.
  - Updated `packages/rettangoli-check/src/core/registry.js` so `buildSchemaRegistry` supports `normalizeComponentName`, and `buildProjectSchemaRegistry` now trims schema `componentName` before registry insertion.
  - Updated `packages/rettangoli-check/src/rules/listenerConfig.js` to track invalid ref keys and skip listener-option/contract validation for listeners attached to those refs.
  - Updated `packages/rettangoli-check/src/rules/crossFileSymbols.js` to skip handler/action export checks for listeners on invalid ref keys.
  - Ran the full scenario suite after changes.
- blockers encountered:
  - No blockers.
- next-step hypothesis:
  - Add focused coverage for malformed `refs` value shapes that currently do not emit dedicated diagnostics, while preserving non-cascading behavior for downstream listener checks.

## Iteration 6 - 2026-02-13T17:06:52Z
- focus: Increase reliability of schema and listener contract checks.
- codex_exit: 0
- eval_exit: 0
- pass_count: 65
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added scenario `64-project-schema-registry-trims-component-name-whitespace` to lock schema-registry normalization behavior: `packages/rettangoli-check/test/scenarios/64-project-schema-registry-trims-component-name-whitespace/expected.json:1`.
- Added scenario `65-listener-invalid-ref-key-short-circuits-listener-contract` to lock listener short-circuit behavior on invalid ref keys: `packages/rettangoli-check/test/scenarios/65-listener-invalid-ref-key-short-circuits-listener-contract/expected.json:1`.
- Updated project schema registry normalization so project `componentName` values are trimmed before contract insertion: `packages/rettangoli-check/src/core/registry.js:72`, `packages/rettangoli-check/src/core/registry.js:407`.
- Updated listener config checks to skip downstream listener-option validation for refs already flagged invalid (`RTGL-CHECK-REF-001`): `packages/rettangoli-check/src/rules/listenerConfig.js:237`, `packages/rettangoli-check/src/rules/listenerConfig.js:304`.
- Updated cross-file symbol checks to skip handler/action export diagnostics for invalid refs: `packages/rettangoli-check/src/rules/crossFileSymbols.js:6`, `packages/rettangoli-check/src/rules/crossFileSymbols.js:32`, `packages/rettangoli-check/src/rules/crossFileSymbols.js:61`.
- Appended iteration 6 journal entry with timestamp, completed changes, blockers, and next-step hypothesis: `packages/rettangoli-check/.codex-journal.md:3641`.

**Why this improves reliability/simplicity**
- Reduces false-positive cascades:
  - Schema whitespace in `componentName` now still yields the schema error, but no extra unknown-element YAHTML noise for trimmed usage.
  - Invalid ref keys now produce the primary ref-contract error without piling on misleading listener/symbol follow-up errors.
- Keeps behavior deterministic and small in scope with scenario-first coverage and minimal rule changes.

**Scenario test result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 65/65`
### Eval Log (tail)
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target
PASS 61-selector-explicit-key-multiline :: selector explicit-key multiline list mapping
PASS 62-missing-schema-prefers-view-file :: missing schema prefers view file location
PASS 63-project-schema-registry-duplicate-component-merges-props :: project schema registry duplicate component merges props
PASS 64-project-schema-registry-trims-component-name-whitespace :: project schema registry trims componentName whitespace
PASS 65-listener-invalid-ref-key-short-circuits-listener-contract :: listener invalid ref key short-circuits listener contract checks

All scenarios passed: 65/65

## Iteration 7 - 2026-02-13T17:10:51Z
- completed changes:
  - Added shared rule helpers in `packages/rettangoli-check/src/rules/shared.js` for `isObjectRecord`, `getYamlPathLine`, and `getModelFilePath` to remove duplicated logic across rule modules.
  - Added `packages/rettangoli-check/src/rules/refs.js` with `collectInvalidRefKeys(refs)` and reused it in listener/cross-file rules to consolidate ref-key validation.
  - Refactored `schema`, `listenerConfig`, `crossFileSymbols`, `feParity`, `jempl`, and `constants` rules to use shared helpers while preserving diagnostic behavior.
  - Simplified `buildSchemaRegistry` in `packages/rettangoli-check/src/core/registry.js` by removing a redundant pre-normalization component-name validity branch and validating the normalized name once.
  - Ran the full scenario suite (`node packages/rettangoli-check/test/run-scenarios.mjs`).
- blockers encountered:
  - No blockers.
- next-step hypothesis:
  - Consolidate remaining duplicated path/line-resolution utilities in core modules (`model`, `registry`) into shared pure helpers, then add a targeted scenario for malformed schema `methods` + symbol export interactions to guard against diagnostic-order regressions.

## Iteration 7 - 2026-02-13T17:11:42Z
- focus: Refactor for simplicity: delete dead branches and consolidate helpers.
- codex_exit: 0
- eval_exit: 0
- pass_count: 65
- notes: ok

### Last Codex Message (tail)
**What changed**
- Added shared rule helpers in `packages/rettangoli-check/src/rules/shared.js:1`:
  - `isObjectRecord`
  - `getYamlPathLine`
  - `getModelFilePath`
- Added shared ref-key validator in `packages/rettangoli-check/src/rules/refs.js:1`:
  - `collectInvalidRefKeys(refs)`
- Refactored rules to use shared helpers (no diagnostic code/message changes):
  - `packages/rettangoli-check/src/rules/listenerConfig.js:1`
  - `packages/rettangoli-check/src/rules/crossFileSymbols.js:1`
  - `packages/rettangoli-check/src/rules/schema.js:1`
  - `packages/rettangoli-check/src/rules/feParity.js:1`
  - `packages/rettangoli-check/src/rules/jempl.js:1`
  - `packages/rettangoli-check/src/rules/constants.js:1`
- Removed a redundant pre-normalization validity branch in schema registry build logic at `packages/rettangoli-check/src/core/registry.js:72` (now validates normalized `componentName` once).
- Appended iteration-7 journal entry at `packages/rettangoli-check/.codex-journal.md:3721`.

**Why this improves reliability/simplicity**
- One implementation for repeated helpers removes divergence risk across rules.
- One implementation for invalid-ref detection keeps listener/symbol short-circuit behavior consistent and deterministic.
- Removing the redundant branch in registry ingestion simplifies control flow without changing observed behavior.

**Scenario test result**
- Ran: `node packages/rettangoli-check/test/run-scenarios.mjs`
- Result: `All scenarios passed: 65/65`
### Eval Log (tail)
PASS 28-schema-contract-nonobject-properties :: schema contract ignores non-object propsSchema.properties
PASS 29-listener-option-type-validation :: listener option type validation
PASS 30-listener-option-valid-values :: listener option valid values
PASS 31-cli-help-precedence :: cli help takes precedence over other args
PASS 32-cli-json-error-stdout :: cli json format reports failing result on stdout
PASS 33-yahtml-global-popover-attr :: yahtml global popover attr
PASS 34-cross-file-symbol-multi-export-declarators :: cross-file symbol support for multi-export declarators
PASS 35-selector-quoted-flow-value-colon :: quoted selector with flow-style attr value containing colon
PASS 36-project-schema-registry-augments-ui-tag :: project schema registry augments ui tag
PASS 37-listener-unknown-option :: listener unknown option
PASS 38-listener-flow-mapping-line-fallback :: listener flow mapping line fallback
PASS 39-cli-json-thrown-error-stdout :: cli json format prints runtime errors to stdout
PASS 40-cli-json-dir-file-path-error :: cli json format rejects file path passed to --dir
PASS 41-yahtml-global-microdata-attrs :: yahtml global microdata attrs
PASS 42-cross-file-symbol-export-star :: cross-file symbol support for export star
PASS 43-selector-explicit-key-list :: selector explicit-key list mapping
PASS 44-listener-nonobject-event-listeners :: listener non-object eventListeners config
PASS 45-listener-handler-prefix :: listener handler prefix strict mode
PASS 46-handlers-export-prefix :: handlers export prefix strict mode
PASS 47-ref-invalid-key :: ref invalid key
PASS 48-ref-invalid-element-id-for-refs :: ref invalid element id for refs
PASS 49-jempl-template-parse-error :: jempl template parse error
PASS 50-jempl-listener-payload-parse-error :: jempl listener payload parse error
PASS 51-yahtml-ast-fallback-control-flow :: yahtml ast fallback with control flow
PASS 52-jempl-control-flow-mapping-child :: jempl control-flow mapping child selector
PASS 53-yahtml-object-notation-global-attrs :: yahtml object notation global attrs
PASS 54-yahtml-object-notation-unknown-attr :: yahtml object notation unknown attr
PASS 55-cross-file-symbol-export-star-typescript-target :: cross-file symbol support for export star typescript target
PASS 56-yahtml-event-binding-attr-coverage :: yahtml event binding attr coverage
PASS 57-cross-file-symbol-invalid-named-reexport :: cross-file symbol invalid local named re-export
PASS 58-yahtml-bare-legacy-prop-token :: yahtml bare legacy prop token
PASS 59-yahtml-bare-event-token-no-false-positive :: yahtml bare event token no false positive
PASS 60-cross-file-symbol-explicit-js-specifier-typescript-target :: cross-file symbol explicit js specifier typescript target
PASS 61-selector-explicit-key-multiline :: selector explicit-key multiline list mapping
PASS 62-missing-schema-prefers-view-file :: missing schema prefers view file location
PASS 63-project-schema-registry-duplicate-component-merges-props :: project schema registry duplicate component merges props
PASS 64-project-schema-registry-trims-component-name-whitespace :: project schema registry trims componentName whitespace
PASS 65-listener-invalid-ref-key-short-circuits-listener-contract :: listener invalid ref key short-circuits listener contract checks

All scenarios passed: 65/65
