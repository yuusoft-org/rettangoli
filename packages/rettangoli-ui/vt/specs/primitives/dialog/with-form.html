---
title: "Dialog with Form"
---
<rtgl-view g="lg" p="lg" wh="f" fw="w">
  <rtgl-button id="button">Open Form Dialog</rtgl-button>
  <rtgl-dialog id="dialog">
  </rtgl-dialog>
</rtgl-view>

<rtgl-global-ui></rtgl-global-ui>

<script>

const dialog = document.getElementById('dialog');
  const form = document.createElement('rtgl-form');
  let isDirty = false;

  form.setAttribute('id', 'form');
  form.setAttribute('slot', 'content');

  form.defaultValues = {
    name: '',
    email: '',
    favoriteColor: '#3498db',
    experience: 3
  };

  form.form = {
    title: 'User Registration',
    description: 'Please fill out your information',
    fields: [{
      id: 'name',
      fieldName: 'name',
      inputType: 'inputText',
      label: 'Full Name',
      description: 'Enter your full name',
      placeholder: 'John Doe'
    }, {
      id: 'email',
      fieldName: 'email',
      inputType: 'inputText',
      label: 'Email Address',
      description: 'Enter your email address',
      placeholder: 'john@example.com'
    }, {
      id: 'favoriteColor',
      fieldName: 'favoriteColor',
      inputType: 'colorPicker',
      label: 'Favorite Color',
      description: 'Pick your favorite color',
      value: '#3498db'
    }, {
      id: 'experience',
      fieldName: 'experience',
      inputType: 'slider',
      label: 'Years of Experience',
      description: 'How many years of experience do you have?',
      min: 0,
      max: 20,
      step: 1,
      value: 3
    }],
    actions: {
      buttons: [{
        id: 'cancel',
        content: 'Cancel',
      }, {
        id: 'submit',
        variant: 'pr',
        content: 'Register',
      }],
    }
  };

  form.addEventListener('action-click', (e) => {
    console.log('Form action:', e.detail);
    if (e.detail.actionId === 'cancel') {
      // Check if dirty and show confirmation
      if (isDirty) {
        showCloseConfirmation();
      } else {
        dialog.removeAttribute('open');
      }
    } else if (e.detail.actionId === 'submit') {
      console.log('Form submitted with values:', e.detail.formValues);
      // Mark as clean before closing since we're "saving"
      isDirty = false;
      dialog.removeAttribute('open');
    }
  });

  // Handle form changes
  form.addEventListener('input', () => {
    isDirty = true;
  });

  form.addEventListener('change', () => {
    isDirty = true;
  });

  button.addEventListener('click', () => {
    // First open the dialog to create the slot
    dialog.setAttribute('open', '');

    // Then append and render the form
    if (!form.parentNode) {
      dialog.appendChild(form);
      form.render();
    }

    // Reset dirty state when opening
    isDirty = false;
  });

  // Listen for dialog close events (overlay click or ESC key)
  dialog.addEventListener('close', () => {
    if (isDirty) {
      showCloseConfirmation();
    } else {
      dialog.removeAttribute('open');
    }
  });

  async function showCloseConfirmation() {
    const globalUI = document.querySelector('rtgl-global-ui');
    if (!globalUI) {
      dialog.removeAttribute('open');
      return;
    }

    const confirmed = await globalUI.transformedHandlers.showConfirm({
      message: 'You have unsaved changes. Are you sure you want to close?',
      title: 'Confirm Close',
      status: 'warning',
      confirmText: 'Close',
      cancelText: 'Cancel'
    });

    if (confirmed) {
      isDirty = false;
      dialog.removeAttribute('open');
    }
  }
</script>
